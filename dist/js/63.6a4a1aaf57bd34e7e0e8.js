(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{1036:function(e,r,t){"use strict";var n=Math.abs;t.r(r);var a=t(2),i=(t(16),t(7)),s=(t(73),t(52),t(46),t(74),t(58),{backgroundColor:"#f3f3f3",title:{text:"客群属性监控图"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{top:"30",data:[]},toolbox:{right:20,feature:{magicType:{type:["line","bar","stack","tiled"]},dataView:{},restore:{show:!0},saveAsImage:{pixelRatio:2}}},grid:{left:"2%",right:"4%",bottom:"50",top:"85",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],dataZoom:[{show:!0,height:30,xAxisIndex:[0],bottom:10,start:0,end:100,handleSize:"110%"},{type:"inside",show:!0,height:15,start:1,end:35},{type:"slider",show:!0,yAxisIndex:0,filterMode:"empty",width:15,height:"60%",handleSize:10,showDataShadow:!1,left:"97%"}],series:[]}),o=t(26),l=t.n(o),c=t(36),h=t.n(c),d=(t(522),t(3)),m=Object(d.a)({props:[],components:{},data:function(){var e=new Date,r=new Date(e.setDate(e.getDate()-7)),t=new Date;new Date;return{closable:!1,line:s,deviceOptions:[{value:"ALL",name:"ALL"},{value:"iPhone",name:"iOS"},{value:"Android",name:"Android"}],customTypes:[{name:"进件客群",value:0},{name:"通过审核客群",value:1}],paramCategory:[{name:"按天",value:1},{name:"按周",value:2},{name:"按月",value:3},{name:"周同期",value:4},{name:"月同期",value:5}],attributes:[],hashes:[1],searchParam:{customType:0,category:1,attribute:"",device:"ALL",dateRange:[r,t],date:t,startMonth:"",endMonth:"",startWeek:"",endWeek:"",seriesStep:""},weeks:4,months:4,activeName:"first",showDetail:!1,name:"detail",isFullScreen:!1,clearable:!1,startWeekClearabe:!0,endWeekClearabe:!0,chartType:"hash",weekOptions:{firstDayOfWeek:7},lineGroup:{},showPercent:!1,noPercentOptions:{},percentSeriesArr:[],percentLineOptions:{}}},computed:{},methods:{formatDate:function(e){("number"==typeof e||"string"==typeof e)&&(e=new Date(e));var r=e.getFullYear(),t=e.getMonth(),n=e.getDate();return r+"/"+(t=9>t?"0"+(t+1):t+1)+"/"+(n=10>n?"0"+n:n)+" "+e.getHours()},getDevices:function(){var e=this;a.a.ajax({url:"/web/requestParam/device",type:"GET",contentType:"application/json",success:function(r){r.data&&r.data.list&&(e.deviceOptions=r.data.list)},error:function(){e.deviceOptions=[{value:"ALL",name:"ALL"},{value:"iPhone",name:"IOS"},{value:"Android",name:"Android"}]}})},getCustomerTypes:function(){var e=this;a.a.ajax({url:"web/requestParam/customerTypes",type:"GET",contentType:"application/json",data:{},success:function(r){if(r.data&&r.data.list){var t=r.data.list,n=t.length;e.customerTypes=[];for(var a=0;a<n;a++)e.customTypes.push(t[a])}},error:function(){}})},getAttributes:function(){var e=this;a.a.ajax({url:"/web/v1/attribute",type:"GET",contentType:"application/json",data:{page:1,pageSize:1e3},dataType:"json",success:function(r){r.data&&r.data.list&&(e.hashes=[],e.attributes=r.data.list,e.attributes.forEach(function(r){r.hash&&e.hashes.push(r.uuid)}))},error:function(e){var r=e.message||e;i.Notification.error({title:"接口错误",message:r})}})},getYear:function(){0>=month2&&(year2-=parseInt(0==parseInt(month2/12)?1:parseInt(month2/12)))},getPreMonthDay:function(e,r){var t=e.getFullYear(),a=e.getMonth(),i=e.getDate(),s=t,o=a+1-r;0>=o&&(s-=parseInt(0==parseInt(n(o)/12)?1:parseInt(n(o)/12)),o=12-n(o)%12);var l=i,c=new Date(s,o,0);return l>(c=c.getDate())&&(l=c),10>l&&(l="0"+l),10>o&&(o="0"+o),s+"-"+o+"-"+l},getPreDay:function(e,r){if(r){var t=e.getFullYear(),a=t,i=e.getMonth()+1,s=e.getDate()-r;return 0>=s&&(0>=--i&&(a=t-1,i=12-n(i)%12),s=new Date(a,i,0).getDate()),a+"-"+(i=10>i?"0"+i:i)+"-"+(s=10>s?"0"+s:s)}},calcAddDate:function(e,r,t,a){var i=e,s=r,o=t,l=a,c={};return o>l?(o-=l,i=1===(s=n(s+1)%12)?i+1:i,c=(l=new Date(i,s,0).getDate())>o?{_year2:i,_month2:s,_day2:o}:this.calcAddDate(i,s,o,l)):c={_year2:i,_month2:s,_day2:o},c},calcReduceDate:function(e,r,t){var a=e,i=r,s=t,o={};return 0>=s?(0>=--i&&(--a,i=12-n(i)%12),o=0<(s=new Date(a,i,0).getDate()+s)?{_year2:a,_month2:i,_day2:s}:this.calcReduceDate(a,i,s)):o={_year2:a,_month2:i,_day2:s},o},getDate:function(e,r){var t,n,a=e.getFullYear(),i=e.getMonth()+1,s=e.getDate()+r;return 0<r?(t=new Date(a,i,0).getDate(),a=(n=this.calcAddDate(a,i,s,t))._year2,i=n._month2,s=n._day2):(a=(n=this.calcReduceDate(a,i,s,t))._year2,i=n._month2,s=n._day2),a+"-"+(i=10>i?"0"+i:i)+"-"+(s=10>s?"0"+s:s)},clearLine:function(){this.line.legend.data=[],this.line.xAxis&&(this.line.xAxis[0].data=[]),this.line.series=[],this.showPercent=!1,this.line.yAxis[0].axisLabel={formatter:"{value}"},this.line.tooltip.formatter=null,this.line.tooltip.axisPointer.label={formatter:"{value}"}},setTitle:function(e,r){var t="";this.customerTypes.some(function(r){var n=!1;return r.value==e&&(t=r.name,n=!0),n});var n="";this.attributes.some(function(e){var t=!1;return e.value==r&&(n=e.name,t=!0),t}),this.line.title.text=t+"-"+n},formaterWeek:function(e){var r=this.getDate(new Date(e),1),t=new Date(r);return r+" 第"+getWeekNumber(t)+"周"},formateMonth:function(e){return this.formatDate(e,"yyyy-MM")},setOptions:function(e,r,t){var n=this,a=r.length;this.line.xAxis[0].data=r,t&&e.map(function(e,r,a){a[r]=n.formatSeriesAndLegend(t,e)}),this.line.legend.data=e;for(var i=0;i<e.length;i++)this.lineGroup[e[i]]=i,this.line.series.push({name:e[i],type:"line",label:{normal:{show:!0}},areaStyle:{normal:{}},data:Array(a).fill(0)});this.percentSeriesArr=Array(a).fill("")},extractPercentSeriesArr:function(e,r){this.percentSeriesArr[e]||(this.percentSeriesArr[e]={}),this.percentSeriesArr[e][r.category]=r.value;var t=+r.value;t=t||0,this.percentSeriesArr[e].xIndex=e,this.percentSeriesArr[e].total?this.percentSeriesArr[e].total+=t:this.percentSeriesArr[e].total=t},formatSeriesAndLegend:function(e,r){return 2===e?this.formaterWeek(r):3===e?this.formateMonth(r):r},formatHashxAxisData:function(e){var r=this;2===e?this.line.xAxis[0].data.map(function(e,t,n){n[t]=r.formaterWeek(e)}):3===e&&this.line.xAxis[0].data.map(function(e,t,n){n[t]=r.formateMonth(e)})},formatSeriesxAxisData:function(e){var r=this;2===e?(this.line.legend.data.map(function(e,t,n){n[t]=r.formaterWeek(e)}),this.line.series.map(function(e,t,n){n[t].name=r.formaterWeek(e.name)})):3===e&&(this.line.legend.data.map(function(e,t,n){n[t]=r.formateMonth(e)}),this.line.series.map(function(e,t,n){n[t].name=r.formateMonth(e.name)}))},setPercentOptions:function(){var e=this;this.percentLineOptions=h()(this.line),this.percentSeriesArr.forEach(function(r){for(var t in r)if(-1===["xIndex","legendIndex","total"].indexOf(t)){var n=e.line.legend.data.indexOf(t),a=100*(r[t]/r.total).toFixed(4);a=/^(\+)?\d+$/.test(a)?a:a.toFixed(2),e.percentLineOptions.series[n].data[r.xIndex]=a,e.percentLineOptions.series[n].label.normal.formatter="{c}%"}}),this.percentLineOptions.tooltip.formatter=function(e){if("[object Array]"==Object.prototype.toString.call(e)){for(var r=e.length,t=e[0].name,n=0;n<r;n++)t+='<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:'+e[n].color+'"></span>'+e[n].seriesName+" : "+e[n].value+"% ";return t}},this.percentLineOptions.yAxis[0].axisLabel={formatter:"{value} %"},this.percentLineOptions.tooltip.axisPointer.label={formatter:function(e){return"number"==typeof e.value?e.value.toFixed(2)+"%":""+e.value}}},search:function(){var e=this,r=this.searchParam,t=r.customType,n=r.category,s=r.attribute,o=r.dateRange,l=r.startWeek,c=r.endWeek,h=r.startMonth,d=r.endMonth,m=r.date,p=this.weeks,u=this.months,y=void 0,A=void 0,f={};if(s){switch(n){case 1:if(!o[0])return void this.$message("时间范围不能为空！");f={category:n,customType:t,attribute:s,startDate:this.formatDate(o[0],"yyyy-MM-dd"),endDate:this.formatDate(o[1],"yyyy-MM-dd")};break;case 2:if(!l)return void this.$message("开始周不能为空！");if(!c)return void this.$message("结束周不能为空！");f={category:n,customType:t,attribute:s,startDate:this.getPreDay(l,1),endDate:this.getPreDay(c,1)};break;case 3:if(!h)return void this.$message("开始月份不能为空！");if(!d)return void this.$message("结束月份不能为空！");f={category:n,customType:t,attribute:s,startDate:this.formatDate(h,"yyyy-MM-dd"),endDate:this.formatDate(d,"yyyy-MM-dd")};break;case 4:if(!m)return void this.$message("比较基础日期不能为空！");if(!p)return void this.$message("请选择往前同期的周数！");y=this.getDate(m,7*-p),f={category:n,customType:t,attribute:s,startDate:y,endDate:this.formatDate(m,"yyyy-MM-dd")};break;case 5:if(!m)return void this.$message("比较基础日期不能为空！");if(!u)return void this.$message("请选择往前同期的月数！");A=this.getPreMonthDay(m,u),f={category:n,customType:t,attribute:s,startDate:A,endDate:this.formatDate(m,"yyyy-MM-dd")}}this.$refs.line.showLoading({text:"正在加载",color:"#4ea397",maskColor:"rgba(255, 255, 255, 0.4)"}),a.a.ajax({url:"/web/v1/statistic/query",type:"post",contentType:"application/json",data:f,success:function(r){var t;e.$refs.line.hideLoading(),e.clearLine(),r.data&&r.data.list&&(t=r.data,!r.status&&("hash"==e.chartType?(e.setOptions(t.categories,t.dates),t.list.forEach(function(r){var t=e.lineGroup[r.category],n=e.line.xAxis[0].data.indexOf(r.date);e.line.series[t].data[n]=r.value,e.extractPercentSeriesArr(n,r)}),e.formatHashxAxisData(n),e.setPercentOptions()):(e.setOptions(t.dates,t.categories,n),t.list.forEach(function(r){var t=e.lineGroup[e.formatSeriesAndLegend(n,r.date)],a=e.line.xAxis[0].data.indexOf(r.category);e.line.series[t].data[a]=r.value}))))},error:function(r){e.$refs.line.hideLoading();var t=r.message||r;i.Notification.error({title:"错误",message:t})}})}else this.$message("属性不能为空！")},handleClick:function(e){0==e.index&&(this.activeName="first")},handleCategoryChange:function(){console.dir(this.searchParam)},handleAttributeChange:function(e){this.chartType=0<=this.hashes.indexOf(e)?"hash":"series",this.showPercent=!1},switchPercent:function(e){return this.percentLineOptions.series?void(!this.line.series.length||(e?(this.noPercentOptions=h()(this.line),this.line=this.percentLineOptions):this.line=this.noPercentOptions)):(this.$message("请重新查询后再切换百分比模式！"),void this.clearLine())}},created:function(){},mounted:function(){var e=l()(".contents").height()-180;l()(".chartClass").css("height",e),this.$refs.line.resize();var r=this.$refs.line;r.showLoading({text:"正在加载",color:"#4ea397",maskColor:"rgba(255, 255, 255, 0.4)"}),this.getAttributes(),r.hideLoading()},beforeDestroy:function(){this.clearLine()},watch:{weeks:function(e){(function(e){return parseInt(e,10)===e})(e)||this.$refs.weeks.setCurrentValue(parseInt(e,10))},months:function(e){(function(e){return parseInt(e,10)===e})(e)||this.$refs.months.setCurrentValue(parseInt(e,10))}}},function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(r){e.activeName=r},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:"客群监控",name:"first"}},[t("div",{staticClass:"p_6"},[t("div",{staticClass:"search-wrapper"},[t("div",{staticClass:"search-content"},[t("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"查询类别"},on:{change:e.handleCategoryChange},slot:"prepend",model:{value:e.searchParam.category,callback:function(r){e.$set(e.searchParam,"category",r)},expression:"searchParam.category"}},e._l(e.paramCategory,function(e){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1),e._v(" "),t("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:1===e.searchParam.category,expression:"searchParam.category === 1"}],attrs:{type:"daterange",placeholder:"选择日期范围"},model:{value:e.searchParam.dateRange,callback:function(r){e.$set(e.searchParam,"dateRange",r)},expression:"searchParam.dateRange"}}),e._v(" "),t("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:2===e.searchParam.category,expression:"searchParam.category === 2"}],ref:"startWeek",attrs:{"picker-options":e.weekOptions,clearable:e.startWeekClearabe,type:"week",format:"yyyy 第 WW 周",placeholder:"选择开始周"},model:{value:e.searchParam.startWeek,callback:function(r){e.$set(e.searchParam,"startWeek",r)},expression:"searchParam.startWeek"}}),e._v(" "),t("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:2===e.searchParam.category,expression:"searchParam.category === 2"}],ref:"endWeek",attrs:{"picker-options":e.weekOptions,clearable:e.endWeekClearabe,type:"week",format:"yyyy 第 WW 周",placeholder:"选择结束周"},model:{value:e.searchParam.endWeek,callback:function(r){e.$set(e.searchParam,"endWeek",r)},expression:"searchParam.endWeek"}}),e._v(" "),t("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:3===e.searchParam.category,expression:"searchParam.category === 3"}],ref:"startMonth",attrs:{type:"month",placeholder:"选择月"},model:{value:e.searchParam.startMonth,callback:function(r){e.$set(e.searchParam,"startMonth",r)},expression:"searchParam.startMonth"}}),e._v(" "),t("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:3===e.searchParam.category,expression:"searchParam.category === 3"}],ref:"endMonth",attrs:{type:"month",placeholder:"选择月"},model:{value:e.searchParam.endMonth,callback:function(r){e.$set(e.searchParam,"endMonth",r)},expression:"searchParam.endMonth"}}),e._v(" "),t("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:4===e.searchParam.category||5===e.searchParam.category,expression:"searchParam.category === 4||searchParam.category === 5"}],attrs:{type:"date",placeholder:"选择日期"},model:{value:e.searchParam.date,callback:function(r){e.$set(e.searchParam,"date",r)},expression:"searchParam.date"}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:4===e.searchParam.category,expression:"searchParam.category === 4"}],staticClass:"input-weeks"},[t("el-input-number",{ref:"weeks",staticStyle:{width:"120px"},attrs:{min:1,max:100},model:{value:e.weeks,callback:function(r){e.weeks=r},expression:"weeks"}})],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:5===e.searchParam.category,expression:"searchParam.category === 5"}],staticClass:"input-months"},[t("el-input-number",{ref:"months",staticStyle:{width:"120px"},attrs:{min:1,max:100},model:{value:e.months,callback:function(r){e.months=r},expression:"months"}})],1),e._v(" "),t("el-select",{staticStyle:{width:"130px"},attrs:{slot:"prepend",placeholder:"请选择客群"},slot:"prepend",model:{value:e.searchParam.customType,callback:function(r){e.$set(e.searchParam,"customType",r)},expression:"searchParam.customType"}},e._l(e.customTypes,function(e){return t("el-option",{key:e.value,attrs:{label:e.name,value:e.value}})}),1),e._v(" "),t("el-select",{staticStyle:{width:"260px"},attrs:{slot:"prepend",clearable:e.clearable,placeholder:"请选择属性"},on:{change:e.handleAttributeChange},slot:"prepend",model:{value:e.searchParam.attribute,callback:function(r){e.$set(e.searchParam,"attribute",r)},expression:"searchParam.attribute"}},e._l(e.attributes,function(e){return t("el-option",{key:e.uuid,attrs:{label:e.name,value:e.uuid}})}),1)],1),e._v(" "),t("div",{staticClass:"search-btn"},[t("el-button",{staticStyle:{width:"80px"},attrs:{slot:"append",icon:"search"},on:{click:e.search},slot:"append"},[e._v("查询")])],1)]),e._v(" "),t("hr"),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"hash"==e.chartType,expression:"chartType=='hash'"}],staticClass:"mrg-tb-10"},[t("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("百分比模式")]),e._v(" "),t("el-switch",{on:{change:e.switchPercent},model:{value:e.showPercent,callback:function(r){e.showPercent=r},expression:"showPercent"}})],1),e._v(" "),t("chart",{ref:"line",staticClass:"chartClass",attrs:{options:e.line,theme:"ovilia-green","auto-resize":""}}),e._v(" "),t("el-alert",{attrs:{title:"",type:"info",description:"提示：图表下方和右侧灰色区域两头可拖动控制相应联动区域的缩小和放大，方便数据查看，光标在图表区域内鼠标滑轮滑动亦可以！","show-icon":"",closable:e.closable}}),e._v(" "),t("el-alert",{attrs:{title:"",description:"警告：图表右上角工具条数据视图点开情况下，请勿点击查询按钮，如点击查询再点击数据视图内刷新后会与前一查询结果重合且图表类型变化，可点击工具条还原按钮还原！","show-icon":"",type:"warning",closable:e.closable}})],1)])],1)},[],!1,null,"08c01ff2",null);r.default=m.exports},161:function(e,r,t){var n=t(523);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,t(5).default)("5db178a9",n,!0,{})},2:function(e,r,t){"use strict";var n=t(32),a=t.n(n),i=t(51),s=t.n(i),o=t(26),l=t.n(o),c=t(16),h=function(e,r){return e.title="好分期报表系统",e.ajax=function(t){e.token=c.a.getToken();var n,i=t.url,o=+new Date;if(0<=i.indexOf("api/")){var l=c.a.getOldToken();o=l.timestamp,n=l.token}else n=e.token;t.uploadFiles||(t.type&&"get"==t.type.toLowerCase()?s()(t.data):"object"===s()(t.data)&&(t.data=a()(t.data))),r.ajax({headers:{Authorization:n,Timestamp:o},url:i,type:t.type||"GET",traditional:!0,data:t.data||{},async:t.async||!0,processData:void 0===t.processData||t.processData,contentType:void 0===t.contentType?r.ajaxSettings.contentType:t.contentType,dataType:t.dataType||"json",success:function(e){return e.status&&"0"!==e.status?void(-1==e.status?(alert("警告: "+e.message),c.a.setAsLoggedOut(),location.href="/#/login"):t.error?t.error(e):alert("警告: "+e.message+"\n错误："+e.status)):void(t.success&&t.success(e))},error:function(e){t.error&&(e.response?t.error(e.response):t.error({message:"请求失败"}))},complete:t.complete||void 0,timeout:t.timeout||null})},e.hasDuplicate=function(e,r){if("[object Array]"!==Object.prototype.toString.call(r))throw new Error("invalid argument");for(var t=0,n=r.length;t<n;t++)if(e==r[t])return!0;return!1},e.formatQuery=function(e){if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("invalid argument");var r=e,t="?";for(var n in r)r.hasOwnProperty(n)&&(t+=n+"="+r[n]+"&");return t},e}(h||{},l.a);r.a=h},51:function(e,r,t){e.exports=t(45)(3)},522:function(e,r,t){"use strict";var n=t(161);t.n(n).a},523:function(e,r,t){(e.exports=t(4)(!0)).push([e.i,"\n.el-select .el-input[data-v-08c01ff2] {\n    width: 200px;\n}\n.pagination_position[data-v-08c01ff2] {\n    padding-top: 20px;\n}\n.search-wrapper[data-v-08c01ff2] {\n    margin: 0px auto 10px;\n}\n.chart-wrapper[data-v-08c01ff2] {\n    display: -webkit-flex; /* Safari */\n    display: flex;\n    display: -ms-flex;\n\n    /*flex主轴方向和主轴溢出排版方式的简写*/\n    -webkit-flex-flow: row wrap;\n    flex-flow: row wrap;\n    -ms-flex-flow: row wrap;\n\n    /*内容在主轴上的对齐方式*/\n    -webkit-justify-content: space-between;\n    justify-content: space-between;\n    -ms-justify-content: space-between;\n\n    /*内容项目在交叉轴上的对齐方式*/\n    -webkit-align-items: stretch;\n    align-items: stretch;\n    -ms-align-items: stretch;\n\n    /*多轴的时候轴线的对齐方式*/\n    -webkit-align-content: stretch;\n    align-content: stretch;\n    -ms-align-content: stretch;\n}\n.echarts[data-v-08c01ff2] {\n    width: 100%;\n    /*min-height: 400px;*/\n    /*height: 100%;*/\n    /*height: calc(100% - 100px);*/\n    /*!*Firefox*!*/\n    /*height: -moz-calc(100% - 100px);*/\n    /*!*chrome safari*!*/\n    /*height: -webkit-calc(100% - 100px);*/\n}\n.right[data-v-08c01ff2] {\n    float: right;\n}\n.input-weeks[data-v-08c01ff2]::before {\n    position: absolute;\n    margin-top: 10px;\n    margin-left: -40px;\n    display: inline-block;\n    content: '同期前';\n    vertical-align: middle;\n}\n.input-weeks[data-v-08c01ff2] {\n    margin-left: 40px;\n    margin-right: 20px;\n    display: inline-block;\n    position: relative;\n    vertical-align: middle;\n}\n.input-weeks[data-v-08c01ff2]::after {\n    position: absolute;\n    margin-top: 10px;\n    margin-left: 5px;\n    margin-right: -20px;\n    display: inline-block;\n    content: '周';\n    vertical-align: middle;\n}\n.input-months[data-v-08c01ff2]::before {\n    position: absolute;\n    margin-top: 10px;\n    margin-left: -40px;\n    display: inline-block;\n    content: '同期前';\n    vertical-align: middle;\n}\n.input-months[data-v-08c01ff2] {\n    margin-left: 40px;\n    margin-right: 20px;\n    display: inline-block;\n    position: relative;\n    vertical-align: middle;\n}\n.input-months[data-v-08c01ff2]::after {\n    position: absolute;\n    margin-top: 10px;\n    margin-left: 5px;\n    margin-right: -20px;\n    display: inline-block;\n    content: '月';\n    vertical-align: middle;\n}\n.mrg-tb-10[data-v-08c01ff2] {\n    margin: 10px 0 10px;\n}\n.warning[data-v-08c01ff2] {\n    color: #F7BA2A;\n}\n","",{version:3,sources:["src/views/contents/risk/customerMonitoring.vue"],names:[],mappings:";AAiKA;IACA,YAAA;AACA;AAEA;IACA,iBAAA;AACA;AAEA;IACA,qBAAA;AACA;AAEA;IACA,qBAAA,EAAA,WAAA;IACA,aAAA;IACA,iBAAA;;IAEA,uBAAA;IACA,2BAAA;IACA,mBAAA;IACA,uBAAA;;IAEA,cAAA;IACA,sCAAA;IACA,8BAAA;IACA,kCAAA;;IAEA,iBAAA;IACA,4BAAA;IACA,oBAAA;IACA,wBAAA;;IAEA,eAAA;IACA,8BAAA;IACA,sBAAA;IACA,0BAAA;AACA;AAEA;IACA,WAAA;IACA,qBAAA;IACA,gBAAA;IACA,8BAAA;IACA,cAAA;IACA,mCAAA;IACA,oBAAA;IACA,sCAAA;AACA;AAEA;IACA,YAAA;AACA;AAEA;IACA,kBAAA;IACA,gBAAA;IACA,kBAAA;IACA,qBAAA;IACA,cAAA;IACA,sBAAA;AACA;AAEA;IACA,iBAAA;IACA,kBAAA;IACA,qBAAA;IACA,kBAAA;IACA,sBAAA;AACA;AAEA;IACA,kBAAA;IACA,gBAAA;IACA,gBAAA;IACA,mBAAA;IACA,qBAAA;IACA,YAAA;IACA,sBAAA;AACA;AAEA;IACA,kBAAA;IACA,gBAAA;IACA,kBAAA;IACA,qBAAA;IACA,cAAA;IACA,sBAAA;AACA;AAEA;IACA,iBAAA;IACA,kBAAA;IACA,qBAAA;IACA,kBAAA;IACA,sBAAA;AACA;AAEA;IACA,kBAAA;IACA,gBAAA;IACA,gBAAA;IACA,mBAAA;IACA,qBAAA;IACA,YAAA;IACA,sBAAA;AACA;AAEA;IACA,mBAAA;AACA;AAEA;IACA,cAAA;AACA",file:"customerMonitoring.vue?vue&type=style&index=0&id=08c01ff2&scoped=true&lang=css&",sourcesContent:['\x3c!--\r\n * @Description: \r\n * @Author: jinxiaojian\r\n * @Email: jinxiaojian@youxin.com\r\n * @Date: 2019-07-12 16:17:33\r\n * @LastEditTime: 2019-07-16 14:29:24\r\n * @LastEditors: 靳肖健\r\n --\x3e\r\n<template>\r\n    <el-tabs v-model="activeName" @tab-click="handleClick">\r\n        <el-tab-pane label="客群监控" name="first">\r\n            <div class="p_6">\r\n                <div class="search-wrapper">\r\n                    <div class="search-content">\r\n                        <el-select v-model="searchParam.category"\r\n                                   @change="handleCategoryChange"\r\n                                   slot="prepend"\r\n                                   placeholder="查询类别"\r\n                                   style="width: 100px;">\r\n                            <el-option\r\n                                v-for="item in paramCategory"\r\n                                :key="item.value"\r\n                                :label="item.name"\r\n                                :value="item.value">\r\n                            </el-option>\r\n                        </el-select>\r\n                        <el-date-picker\r\n                            v-show="searchParam.category === 1"\r\n                            v-model="searchParam.dateRange"\r\n                            type="daterange"\r\n                            placeholder="选择日期范围">\r\n                        </el-date-picker>\r\n                        <el-date-picker\r\n                            ref="startWeek"\r\n                            v-show="searchParam.category === 2"\r\n                            v-model="searchParam.startWeek"\r\n                            :picker-options="weekOptions"\r\n                            :clearable="startWeekClearabe"\r\n                            type="week"\r\n                            format="yyyy 第 WW 周"\r\n                            placeholder="选择开始周">\r\n                        </el-date-picker>\r\n                        <el-date-picker\r\n                            ref="endWeek"\r\n                            v-show="searchParam.category === 2"\r\n                            v-model="searchParam.endWeek"\r\n                            :picker-options="weekOptions"\r\n                            :clearable="endWeekClearabe"\r\n                            type="week"\r\n                            format="yyyy 第 WW 周"\r\n                            placeholder="选择结束周">\r\n                        </el-date-picker>\r\n                        <el-date-picker\r\n                            ref="startMonth"\r\n                            v-show="searchParam.category === 3"\r\n                            v-model="searchParam.startMonth"\r\n                            type="month"\r\n                            placeholder="选择月">\r\n                        </el-date-picker>\r\n                        <el-date-picker\r\n                            ref="endMonth"\r\n                            v-show="searchParam.category === 3"\r\n                            v-model="searchParam.endMonth"\r\n                            type="month"\r\n                            placeholder="选择月">\r\n                        </el-date-picker>\r\n                        <el-date-picker\r\n                            v-show="searchParam.category === 4||searchParam.category === 5"\r\n                            v-model="searchParam.date"\r\n                            type="date"\r\n                            placeholder="选择日期">\r\n                        </el-date-picker>\r\n                        <div v-show="searchParam.category === 4" class="input-weeks">\r\n                            <el-input-number ref="weeks"\r\n                                             v-model="weeks"\r\n                                             :min="1" :max="100"\r\n                                             style="width: 120px;"></el-input-number>\r\n                        </div>\r\n                        \x3c!--<div v-if="searchParam.category === 5"--\x3e\r\n                        \x3c!--style="display: inline-block;position: relative;vertical-align:middle;">同期前--\x3e\r\n                        \x3c!--</div>--\x3e\r\n                        <div v-show="searchParam.category === 5" class="input-months">\r\n                            \x3c!--style="display: inline-block;position: relative;vertical-align:middle;">--\x3e\r\n                            <el-input-number ref="months"\r\n                                             v-model="months"\r\n                                             :min="1" :max="100"\r\n                                             style="width: 120px;"></el-input-number>\r\n                        </div>\r\n                        \x3c!--<div v-if="searchParam.category === 5"--\x3e\r\n                        \x3c!--style="display: inline-block;position: relative;vertical-align:middle;">月--\x3e\r\n                        \x3c!--</div>--\x3e\r\n\r\n                        \x3c!--<el-form-item label="手机设备">--\x3e\r\n                        \x3c!--<el-select v-model="searchParam.device" slot="prepend" placeholder="手机设备" style="width: 100px;">--\x3e\r\n                        \x3c!--<el-option--\x3e\r\n                        \x3c!--v-for="item in deviceOptions"--\x3e\r\n                        \x3c!--:key="item.value"--\x3e\r\n                        \x3c!--:label="item.name"--\x3e\r\n                        \x3c!--:value="item.value">--\x3e\r\n                        \x3c!--</el-option>--\x3e\r\n                        \x3c!--</el-select>--\x3e\r\n                        \x3c!--</el-form-item>--\x3e\r\n                        <el-select v-model="searchParam.customType" slot="prepend" placeholder="请选择客群"\r\n                                   style="width: 130px;">\r\n                            <el-option\r\n                                v-for="item in customTypes"\r\n                                :key="item.value"\r\n                                :label="item.name"\r\n                                :value="item.value">\r\n                            </el-option>\r\n                        </el-select>\r\n                        <el-select v-model="searchParam.attribute"\r\n                                   :clearable="clearable"\r\n                                   @change="handleAttributeChange"\r\n                                   slot="prepend"\r\n                                   placeholder="请选择属性"\r\n                                   style="width: 260px;">\r\n                            <el-option\r\n                                v-for="item in attributes"\r\n                                :key="item.uuid"\r\n                                :label="item.name"\r\n                                :value="item.uuid">\r\n                            </el-option>\r\n                        </el-select>\r\n                        \x3c!--<el-input v-show="chartType ==\'series\'"--\x3e\r\n                        \x3c!--placeholder=""--\x3e\r\n                        \x3c!--style="width:120px;"--\x3e\r\n                        \x3c!--v-model="searchParam.seriesStep">--\x3e\r\n                        \x3c!--<template slot="prepend">步长</template>--\x3e\r\n                        \x3c!--</el-input>--\x3e\r\n                    </div>\r\n                    <div class="search-btn">\r\n                        <el-button slot="append" icon="search" @click="search" style="width:80px; ">查询</el-button>\r\n                    </div>\r\n                </div>\r\n                <hr>\r\n                <div class="mrg-tb-10" v-show="chartType==\'hash\'">\r\n                    <span slot="prepend">百分比模式</span>\r\n                    <el-switch\r\n                        v-model="showPercent"\r\n                        @change="switchPercent">\r\n                    </el-switch>\r\n                </div>\r\n                <chart :options="line" ref="line" theme="ovilia-green" auto-resize class="chartClass"></chart>\r\n                <el-alert\r\n                    title=""\r\n                    type="info"\r\n                    description="提示：图表下方和右侧灰色区域两头可拖动控制相应联动区域的缩小和放大，方便数据查看，光标在图表区域内鼠标滑轮滑动亦可以！"\r\n                    show-icon :closable="closable">\r\n                </el-alert>\r\n                <el-alert\r\n                    title=""\r\n                    description="警告：图表右上角工具条数据视图点开情况下，请勿点击查询按钮，如点击查询再点击数据视图内刷新后会与前一查询结果重合且图表类型变化，可点击工具条还原按钮还原！"\r\n                    show-icon type="warning" :closable="closable">\r\n                </el-alert>\r\n            </div>\r\n        </el-tab-pane>\r\n    </el-tabs>\r\n</template>\r\n\r\n<style scoped>\r\n    .el-select .el-input {\r\n        width: 200px;\r\n    }\r\n\r\n    .pagination_position {\r\n        padding-top: 20px;\r\n    }\r\n\r\n    .search-wrapper {\r\n        margin: 0px auto 10px;\r\n    }\r\n\r\n    .chart-wrapper {\r\n        display: -webkit-flex; /* Safari */\r\n        display: flex;\r\n        display: -ms-flex;\r\n\r\n        /*flex主轴方向和主轴溢出排版方式的简写*/\r\n        -webkit-flex-flow: row wrap;\r\n        flex-flow: row wrap;\r\n        -ms-flex-flow: row wrap;\r\n\r\n        /*内容在主轴上的对齐方式*/\r\n        -webkit-justify-content: space-between;\r\n        justify-content: space-between;\r\n        -ms-justify-content: space-between;\r\n\r\n        /*内容项目在交叉轴上的对齐方式*/\r\n        -webkit-align-items: stretch;\r\n        align-items: stretch;\r\n        -ms-align-items: stretch;\r\n\r\n        /*多轴的时候轴线的对齐方式*/\r\n        -webkit-align-content: stretch;\r\n        align-content: stretch;\r\n        -ms-align-content: stretch;\r\n    }\r\n\r\n    .echarts {\r\n        width: 100%;\r\n        /*min-height: 400px;*/\r\n        /*height: 100%;*/\r\n        /*height: calc(100% - 100px);*/\r\n        /*!*Firefox*!*/\r\n        /*height: -moz-calc(100% - 100px);*/\r\n        /*!*chrome safari*!*/\r\n        /*height: -webkit-calc(100% - 100px);*/\r\n    }\r\n\r\n    .right {\r\n        float: right;\r\n    }\r\n\r\n    .input-weeks::before {\r\n        position: absolute;\r\n        margin-top: 10px;\r\n        margin-left: -40px;\r\n        display: inline-block;\r\n        content: \'同期前\';\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .input-weeks {\r\n        margin-left: 40px;\r\n        margin-right: 20px;\r\n        display: inline-block;\r\n        position: relative;\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .input-weeks::after {\r\n        position: absolute;\r\n        margin-top: 10px;\r\n        margin-left: 5px;\r\n        margin-right: -20px;\r\n        display: inline-block;\r\n        content: \'周\';\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .input-months::before {\r\n        position: absolute;\r\n        margin-top: 10px;\r\n        margin-left: -40px;\r\n        display: inline-block;\r\n        content: \'同期前\';\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .input-months {\r\n        margin-left: 40px;\r\n        margin-right: 20px;\r\n        display: inline-block;\r\n        position: relative;\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .input-months::after {\r\n        position: absolute;\r\n        margin-top: 10px;\r\n        margin-left: 5px;\r\n        margin-right: -20px;\r\n        display: inline-block;\r\n        content: \'月\';\r\n        vertical-align: middle;\r\n    }\r\n\r\n    .mrg-tb-10 {\r\n        margin: 10px 0 10px;\r\n    }\r\n\r\n    .warning {\r\n        color: #F7BA2A;\r\n    }\r\n</style>\r\n\r\n<script>\r\n    import Common from \'../../../utils/common\'\r\n    import auth from \'../../../utils/authenticate\'\r\n    import {Notification} from \'element-ui\'\r\n\r\n    // import {getWeekNumber, formatDate} from \'../../../../node_modules/element-ui/packages/date-picker/src/util/index\'\r\n\r\n    //引入Echats图表组件\r\n    //  import VueECharts from \'vue-echarts/components/ECharts.vue\'\r\n\r\n    import \'echarts/lib/component/grid\'\r\n    import \'echarts/lib/component/toolbox\'\r\n    import \'echarts/lib/component/tooltip\'\r\n    import \'echarts/lib/component/legend\'\r\n\r\n    // built-in theme\r\n    import \'echarts/theme/dark\'\r\n    import customerLineData from \'../../../data/customerLine\'\r\n\r\n    import $ from \'jquery\'\r\n    import deepcopy from "deepcopy"\r\n    //  import Vue from \'vue\'\r\n\r\n    export default {\r\n\r\n        props: [],\r\n        components: {},\r\n        data(){\r\n            let date = new Date();\r\n            let prevMonth = new Date(date.setDate(date.getDate() - 7));\r\n            let now = new Date();\r\n            let currentWeekNumber = new Date();\r\n\r\n            return {\r\n                closable: false,\r\n                line: customerLineData,\r\n                deviceOptions: [\r\n                    {\r\n                        value: \'ALL\',\r\n                        name: \'ALL\',\r\n                    },\r\n                    {\r\n                        value: \'iPhone\',\r\n                        name: \'iOS\',\r\n                    },\r\n                    {\r\n                        value: \'Android\',\r\n                        name: \'Android\'\r\n                    }],\r\n                customTypes: [\r\n                    {\r\n                        name: \'进件客群\',\r\n                        value: 0,\r\n                    },\r\n                    {\r\n                        name: \'通过审核客群\',\r\n                        value: 1,\r\n                    }\r\n                ],\r\n                paramCategory: [\r\n                    {\r\n                        name: \'按天\',\r\n                        value: 1\r\n                    },\r\n                    {\r\n                        name: \'按周\',\r\n                        value: 2\r\n                    },\r\n                    {\r\n                        name: \'按月\',\r\n                        value: 3\r\n                    },\r\n                    {\r\n                        name: \'周同期\',\r\n                        value: 4\r\n                    },\r\n                    {\r\n                        name: \'月同期\',\r\n                        value: 5\r\n                    },\r\n                ],\r\n                attributes: [],\r\n                hashes: [1],\r\n                searchParam: {\r\n                    customType: 0,\r\n                    category: 1,\r\n                    attribute: "",\r\n                    device: "ALL",\r\n                    dateRange: [prevMonth, now],\r\n                    date: now,\r\n                    startMonth: \'\',\r\n                    endMonth: \'\',\r\n                    startWeek: \'\',//new Date(this.getDate(currentWeekNumber,-49)),\r\n                    endWeek: \'\',//currentWeekNumber,\r\n                    seriesStep: \'\',\r\n//                  weeks:4,\r\n//                  months:4,\r\n                },\r\n                weeks: 4,\r\n                months: 4,\r\n                activeName: \'first\',\r\n                showDetail: false,\r\n                name: \'detail\',\r\n                isFullScreen: false,\r\n                clearable: false,\r\n                startWeekClearabe: true,\r\n                endWeekClearabe: true,\r\n                chartType: "hash",\r\n                weekOptions: {\r\n                    firstDayOfWeek: 7,\r\n                },\r\n                lineGroup: {},\r\n                showPercent: false,//切换百分比模式\r\n                noPercentOptions: {},\r\n                percentSeriesArr: [],\r\n                percentLineOptions: {},\r\n            }\r\n        },\r\n        computed: {},\r\n        methods: {\r\n               formatDate(date) {\r\n      if (typeof date == "number" || typeof date == "string") {\r\n        date = new Date(date);\r\n      }\r\n      var _year = date.getFullYear();\r\n      var _month = date.getMonth();\r\n      var _day = date.getDate();\r\n      var _hour = date.getHours();\r\n      _day = _day < 10 ? "0" + _day : _day;\r\n      _month = _month < 9 ? "0" + (_month + 1) : _month + 1;\r\n      return `${_year}/${_month}/${_day} ${_hour}`;\r\n    },\r\n            getDevices(){\r\n                Common.ajax({\r\n                    url: \'/web/requestParam/device\',\r\n                    type: \'GET\',\r\n                    contentType: \'application/json\',\r\n                    success: (response) => {\r\n                        if (response.data && response.data.list) {\r\n                            this.deviceOptions = response.data.list;\r\n                        }\r\n                    },\r\n                    error: (err) => {\r\n                        this.deviceOptions = [{\r\n                            value: \'ALL\',\r\n                            name: \'ALL\',\r\n                        }, {\r\n                            value: \'iPhone\',\r\n                            name: \'IOS\',\r\n                        }, {\r\n                            value: \'Android\',\r\n                            name: \'Android\'\r\n                        }];\r\n                    }\r\n                });\r\n            },\r\n\r\n            getCustomerTypes(){\r\n                Common.ajax({\r\n                    url: \'web/requestParam/customerTypes\',\r\n                    type: \'GET\',\r\n                    contentType: "application/json",\r\n                    data: {},\r\n                    success: (response) => {\r\n                        if (response.data && response.data.list) {\r\n                            let customerTypes = response.data.list;\r\n                            let len = customerTypes.length;\r\n                            this.customerTypes = [];\r\n                            for (var i = 0; i < len; i++) {\r\n                                this.customTypes.push(customerTypes[i]);\r\n                            }\r\n                        }\r\n                    },\r\n                    error(err){\r\n                        /*            let error = err.message || err;\r\n                         Notification.error({\r\n                         title: \'错误\',\r\n                         message: error\r\n                         });*/\r\n                    }\r\n                });\r\n            },\r\n            getAttributes(){\r\n                Common.ajax({\r\n                    url: \'/web/v1/attribute\',\r\n                    type: \'GET\',\r\n                    contentType: \'application/json\',\r\n                    data: {\r\n                    \tpage:1,\r\n                        pageSize:1000\r\n                    },\r\n                    dataType:\'json\',\r\n                    success: (response) => {\r\n                        if (response.data && response.data.list) {\r\n                            this.hashes = [];\r\n                            this.attributes = response.data.list;\r\n                            this.attributes.forEach((item, index, arr) => {\r\n                                if (item.hash) {\r\n                                    this.hashes.push(item.uuid);\r\n                                }\r\n                            });\r\n                        }\r\n                    },\r\n                    error: (err) => {\r\n                        let error = err.message || err;\r\n                        Notification.error({\r\n                            title: \'接口错误\',\r\n                            message: error\r\n                        });\r\n                    }\r\n                });\r\n            },\r\n\r\n            getYear(year, month){\r\n                if (month2 <= 0) {\r\n                    year2 = year2 - parseInt(parseInt(month2 / 12) == 0 ? 1 : parseInt(month2 / 12));\r\n                } else {\r\n\r\n                }\r\n            },\r\n\r\n            getPreMonthDay: function (date, monthNum) {\r\n                var year = date.getFullYear(); //获取当前日期的年份\r\n                var month = date.getMonth(); //获取当前日期的月份\r\n                var day = date.getDate(); //获取当前日期的日\r\n\r\n                var year2 = year;\r\n                var month2 = month + 1 - monthNum;\r\n                if (month2 <= 0) {\r\n                    year2 = year2 - parseInt(parseInt(Math.abs(month2) / 12) == 0 ? 1 : parseInt(Math.abs(month2) / 12));\r\n                    month2 = 12 - (Math.abs(month2) % 12);\r\n                }\r\n                var day2 = day;\r\n                var days2 = new Date(year2, month2, 0);\r\n                days2 = days2.getDate();\r\n                if (day2 > days2) {\r\n                    day2 = days2;\r\n                }\r\n                if (day2 < 10) {\r\n                    day2 = \'0\' + day2;\r\n                }\r\n                if (month2 < 10) {\r\n                    month2 = \'0\' + month2;\r\n                }\r\n                var t2 = year2 + \'-\' + month2 + \'-\' + day2;\r\n                return t2;\r\n            },\r\n\r\n            getPreDay: function (date, num) {\r\n                if (!num)return;\r\n                var _year = date.getFullYear();\r\n                var _month = date.getMonth();\r\n                var _day = date.getDate();\r\n\r\n                var _year2 = _year;\r\n                var _month2 = _month + 1;\r\n                var _day2 = _day - num;\r\n                if (_day2 <= 0) {\r\n                    _month2 = _month2 - 1;\r\n                    if (_month2 <= 0) {\r\n                        _year2 = _year - 1;\r\n                        _month2 = 12 - (Math.abs(_month2) % 12);\r\n                    }\r\n                    _day2 = (new Date(_year2, _month2, 0)).getDate();\r\n                }\r\n\r\n                _day2 = _day2 < 10 ? \'0\' + _day2 : _day2;\r\n                _month2 = _month2 < 10 ? \'0\' + _month2 : _month2;\r\n\r\n                return `${_year2}-${_month2}-${_day2}`;\r\n\r\n            },\r\n\r\n            /**\r\n             * 计算加多少天\r\n             */\r\n            calcAddDate(year, month, day, days){\r\n                let _year2 = year;\r\n                let _month2 = month;\r\n                let _day2 = day;\r\n                let _days = days;\r\n                let obj = {};\r\n                if (_day2 > _days) {\r\n                    _day2 = _day2 - _days;\r\n                    _month2 = Math.abs(_month2 + 1) % 12;\r\n                    _year2 = _month2 === 1 ? _year2 + 1 : _year2;\r\n                    _days = (new Date(_year2, _month2, 0)).getDate();\r\n                    if (_days > _day2) {\r\n                        obj = {\r\n                            _year2: _year2,\r\n                            _month2: _month2,\r\n                            _day2: _day2,\r\n                        };\r\n                    } else {\r\n                        obj = this.calcAddDate(_year2, _month2, _day2, _days);\r\n                    }\r\n                } else {\r\n                    obj = {\r\n                        _year2: _year2,\r\n                        _month2: _month2,\r\n                        _day2: _day2,\r\n                    }\r\n                }\r\n                ;\r\n                return obj;\r\n            },\r\n\r\n            /**\r\n             * 计算减去多少天\r\n             */\r\n            calcReduceDate(year, month, day){\r\n                let _year2 = year;\r\n                let _month2 = month;\r\n                let _day2 = day;\r\n                let _days;\r\n                let obj = {};\r\n\r\n                if (_day2 <= 0) {\r\n                    _month2 = _month2 - 1;\r\n                    if (_month2 <= 0) {\r\n                        _year2 = _year2 - 1;\r\n                        _month2 = 12 - (Math.abs(_month2) % 12);\r\n                    }\r\n                    _days = (new Date(_year2, _month2, 0)).getDate();\r\n                    _day2 = _days + _day2;\r\n                    if (_day2 > 0) {\r\n                        obj = {\r\n                            _year2: _year2,\r\n                            _month2: _month2,\r\n                            _day2: _day2,\r\n                        };\r\n                    } else {\r\n                        obj = this.calcReduceDate(_year2, _month2, _day2);\r\n                    }\r\n                } else {\r\n                    obj = {\r\n                        _year2: _year2,\r\n                        _month2: _month2,\r\n                        _day2: _day2,\r\n                    }\r\n                }\r\n                return obj;\r\n            },\r\n\r\n            /**\r\n             *\r\n             */\r\n            getDate(date, day, format){\r\n                var _year = date.getFullYear();\r\n                var _month = date.getMonth();\r\n                var _day = date.getDate();\r\n\r\n                var _year2 = _year;\r\n                var _month2 = _month + 1;\r\n                var _day2 = _day + day;\r\n\r\n                var _days;\r\n                var _cDate;\r\n                if (day > 0) {\r\n                    _days = (new Date(_year2, _month2, 0)).getDate();\r\n                    _cDate = this.calcAddDate(_year2, _month2, _day2, _days);\r\n                    _year2 = _cDate._year2;\r\n                    _month2 = _cDate._month2;\r\n                    _day2 = _cDate._day2;\r\n                } else {\r\n                    _cDate = this.calcReduceDate(_year2, _month2, _day2, _days);\r\n                    _year2 = _cDate._year2;\r\n                    _month2 = _cDate._month2;\r\n                    _day2 = _cDate._day2;\r\n                }\r\n\r\n                _day2 = _day2 < 10 ? \'0\' + _day2 : _day2;\r\n                _month2 = _month2 < 10 ? \'0\' + _month2 : _month2;\r\n\r\n                return `${_year2}-${_month2}-${_day2}`;\r\n\r\n            },\r\n\r\n            clearLine(){\r\n                this.line.legend.data = [];\r\n                this.line.xAxis && (this.line.xAxis[0].data = []);\r\n                this.line.series = [];\r\n                this.showPercent = false;\r\n                this.line.yAxis[0].axisLabel = {\r\n                    formatter: \'{value}\'\r\n                };\r\n                //格式化tooltip的坐标轴指示器显示数值\r\n                this.line.tooltip.formatter = null;\r\n                this.line.tooltip.axisPointer.label = {formatter: "{value}"};\r\n            },\r\n\r\n            /**\r\n             * 根据查询客群类别和属性更新图表title\r\n             * @param customerType 客群类别\r\n             * @param attribute 客群属性\r\n             */\r\n            setTitle(customerType, attribute) {\r\n                //获取类型name\r\n                let customerTypeName = \'\';\r\n                this.customerTypes.some((item, index, arr) => {\r\n                    let rv = false;\r\n                    if (item.value == customerType) {\r\n                        customerTypeName = item.name;\r\n                        rv = true;\r\n                    }\r\n                    return rv\r\n                });\r\n\r\n                //获取属性name\r\n                let attributeName = \'\';\r\n                this.attributes.some((item, index, arr) => {\r\n                    let rv = false;\r\n                    if (item.value == attribute) {\r\n                        attributeName = item.name;\r\n                        rv = true;\r\n                    }\r\n                    return rv\r\n                });\r\n                this.line.title.text = customerTypeName + \'-\' + attributeName;\r\n            },\r\n\r\n            /**\r\n             *  自定义格式化周显示\r\n             */\r\n            formaterWeek(date){\r\n                let _date = this.getDate(new Date(date), 1);\r\n                let _datetime = new Date(_date);\r\n                let _week = getWeekNumber(_datetime);\r\n                return `${_date} 第${_week}周`;\r\n            },\r\n            /**\r\n             * 自定义格式化月显示\r\n             */\r\n            formateMonth(date){\r\n                return this.formatDate(date, \'yyyy-MM\');\r\n            },\r\n            /**\r\n             * 配置chart图表数据\r\n             * @param categorys\r\n             * @param xAxisData\r\n             */\r\n            setOptions(categorys, xAxisData, type){\r\n                let len = xAxisData.length;\r\n                this.line.xAxis[0].data = xAxisData;\r\n                if (type) {\r\n                    categorys.map((item, index, arr) => {\r\n                        arr[index] = this.formatSeriesAndLegend(type, item);\r\n                    });\r\n                }\r\n                this.line.legend.data = categorys;\r\n\r\n                for (var i = 0; i < categorys.length; i++) {\r\n                    //标记series的索引对应的category\r\n                    this.lineGroup[categorys[i]] = i;\r\n                    this.line.series.push({\r\n                        name: categorys[i],//this.formatSeriesAndLegend(type,categorys[i]),\r\n                        type: \'line\',\r\n                        label: {\r\n                            normal: {\r\n                                show: true,\r\n                            }\r\n                        },\r\n                        areaStyle: {normal: {}},\r\n                        data: Array(len).fill(0),\r\n//               data:Array.apply(null, Array(len)).map(() => 0)\r\n                    });\r\n                }\r\n                this.percentSeriesArr = Array(len).fill("");\r\n            },\r\n\r\n            /**\r\n             * 提取数据为百分比需求数据，便于后续转化为百分比格式处理\r\n             * @param dataIdx\r\n             * @param item\r\n             */\r\n            extractPercentSeriesArr: function (dataIdx, item) {\r\n                !this.percentSeriesArr[dataIdx] && (this.percentSeriesArr[dataIdx] = {});\r\n                this.percentSeriesArr[dataIdx][item.category] = item.value;\r\n                let num = Number(item.value);\r\n                num = !!num ? num : 0;\r\n//      //console.log(\'number-------\',this.percentSeriesArr,item,num);\r\n                this.percentSeriesArr[dataIdx].xIndex = dataIdx;\r\n                if (this.percentSeriesArr[dataIdx].total) {\r\n                    this.percentSeriesArr[dataIdx].total += num;\r\n                } else {\r\n                    this.percentSeriesArr[dataIdx].total = num;\r\n                }\r\n            },\r\n\r\n            /**\r\n             *\r\n             */\r\n            formatSeriesAndLegend(type, date){\r\n                let returnValue;\r\n                returnValue = type === 2 ? this.formaterWeek(date) : type === 3 ? this.formateMonth(date) : date;\r\n                return returnValue;\r\n            },\r\n            /**\r\n             *  格式散列图表周和月的xAxisData\r\n             */\r\n            formatHashxAxisData(type){\r\n                if (type === 2) {//格式化周数据\r\n                    this.line.xAxis[0].data.map((item, index, arr) => {\r\n                        arr[index] = this.formaterWeek(item);\r\n                    });\r\n                } else if (type === 3) {//格式化月数据\r\n                    this.line.xAxis[0].data.map((item, index, arr) => {\r\n                        arr[index] = this.formateMonth(item);\r\n                    });\r\n                }\r\n            },\r\n            /**\r\n             * 已取消使用\r\n             */\r\n            formatSeriesxAxisData(type){\r\n                //console.log(\'formatSeriesxAxisData\', this.line);\r\n                if (type === 2) {//格式化周数据\r\n                    this.line.legend.data.map((item, index, arr) => {\r\n                        arr[index] = this.formaterWeek(item);\r\n                    });\r\n                    this.line.series.map((item, index, arr) => {\r\n                        arr[index].name = this.formaterWeek(item.name);\r\n                    });\r\n\r\n                } else if (type === 3) {//格式化月数据\r\n                    this.line.legend.data.map((item, index, arr) => {\r\n                        arr[index] = this.formateMonth(item);\r\n                    });\r\n                    this.line.series.map((item, index, arr) => {\r\n                        arr[index].name = this.formateMonth(item.name);\r\n                    });\r\n                }\r\n            },\r\n            /**\r\n             * 设置百分比图表options数据\r\n             */\r\n            setPercentOptions: function () {\r\n                this.percentLineOptions = deepcopy(this.line);\r\n                //格式化数据计算转换为百分比数据值\r\n                this.percentSeriesArr.forEach((item, index, arr) => {\r\n                    for (var key in item) {\r\n                        if ([\'xIndex\', \'legendIndex\', \'total\'].indexOf(key) === -1) {\r\n                            let legendIndex = this.line.legend.data.indexOf(key);\r\n                            let pct = (item[key] / item.total).toFixed(4) * 100;\r\n                            pct = /^(\\+)?\\d+$/.test(pct) ? pct : pct.toFixed(2);\r\n                            this.percentLineOptions.series[legendIndex].data[item.xIndex] = pct;\r\n                            this.percentLineOptions.series[legendIndex].label.normal.formatter = "{c}%";\r\n                        }\r\n                    }\r\n                });\r\n                //格式化提示工具条内数据\r\n                this.percentLineOptions.tooltip.formatter = function (params, ticket, callback) {\r\n                    if (Object.prototype.toString.call(params) == \'[object Array]\') {\r\n                        let len = params.length;\r\n                        let retValue = params[0].name;\r\n                        for (var i = 0; i < len; i++) {\r\n                            retValue += \'<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:\' + params[i].color + \'"></span>\' + params[i].seriesName + \' : \' + params[i].value + "% "\r\n                        }\r\n                        return retValue;\r\n                    }\r\n                };\r\n                //格式化y轴纵坐标刻度值\r\n                this.percentLineOptions.yAxis[0].axisLabel = {\r\n                    formatter: \'{value} %\'\r\n                };\r\n                //格式化tooltip的坐标轴指示器显示数值\r\n                this.percentLineOptions.tooltip.axisPointer.label = {\r\n//        \tformatter:"{value}%"\r\n                    formatter: function (params) {\r\n                        if (typeof params.value === \'number\') {\r\n                            return params.value.toFixed(2) + \'%\';\r\n                        } else {\r\n                            return `${params.value}`;\r\n                        }\r\n                    }\r\n                };\r\n            }, /**\r\n             * 查询\r\n             */\r\n            search(){\r\n                let {customType, category, attribute, dateRange, startWeek, endWeek, startMonth, endMonth, date} = this.searchParam;\r\n                let weeks = this.weeks;\r\n                let months = this.months;\r\n                let startWeekDate;\r\n                let startMonthDate;\r\n\r\n                let queryData = {};\r\n\r\n                if (!attribute) {\r\n                    this.$message(\'属性不能为空！\');\r\n                    return;\r\n                }\r\n\r\n                switch (category) {\r\n                    case 1:\r\n                        if (!dateRange[0]) {\r\n                            this.$message(\'时间范围不能为空！\');\r\n                            return;\r\n                        }\r\n                        queryData = {\r\n                            category: category,\r\n                            customType: customType,\r\n                            attribute: attribute,\r\n                            startDate: this.formatDate(dateRange[0], \'yyyy-MM-dd\'),\r\n                            endDate: this.formatDate(dateRange[1], \'yyyy-MM-dd\'),\r\n                        };\r\n                        //console.log(queryData);\r\n                        break;\r\n                    case 2:\r\n                        if (!startWeek) {\r\n                            this.$message(\'开始周不能为空！\');\r\n                            return;\r\n                        }\r\n                        if (!endWeek) {\r\n                            this.$message(\'结束周不能为空！\');\r\n                            return;\r\n                        }\r\n\r\n                        queryData = {\r\n                            category: category,\r\n                            customType: customType,\r\n                            attribute: attribute,\r\n                            startDate: this.getPreDay(startWeek, 1),\r\n                            endDate: this.getPreDay(endWeek, 1),\r\n//              startWeekNumber:getWeekNumber(startWeek),\r\n//              endWeekNumber:getWeekNumber(startWeek),\r\n                        };\r\n                        //console.log(queryData);\r\n                        break;\r\n                    case 3:\r\n                        if (!startMonth) {\r\n                            this.$message(\'开始月份不能为空！\');\r\n                            return;\r\n                        }\r\n                        if (!endMonth) {\r\n                            this.$message(\'结束月份不能为空！\');\r\n                            return;\r\n                        }\r\n                        //console.log(this.formatDate(startMonth, \'yyyy-MM-dd\'));\r\n                        //console.log(this.formatDate(endMonth, \'yyyy-MM-dd\'));\r\n                        queryData = {\r\n                            category: category,\r\n                            customType: customType,\r\n                            attribute: attribute,\r\n                            startDate: this.formatDate(startMonth, \'yyyy-MM-dd\'),\r\n                            endDate: this.formatDate(endMonth, \'yyyy-MM-dd\'),\r\n                        };\r\n                        //console.log(queryData);\r\n                        break;\r\n                    case 4:\r\n                        if (!date) {\r\n                            this.$message(\'比较基础日期不能为空！\');\r\n                            return;\r\n                        }\r\n                        if (!weeks) {\r\n                            this.$message(\'请选择往前同期的周数！\');\r\n                            return;\r\n                        }\r\n                        //console.log(\'周同期\', date, -weeks * 7);\r\n                        startWeekDate = this.getDate(date, -weeks * 7);\r\n                        queryData = {\r\n                            category: category,\r\n                            customType: customType,\r\n                            attribute: attribute,\r\n                            startDate: startWeekDate,\r\n                            endDate: this.formatDate(date, \'yyyy-MM-dd\'),\r\n                        };\r\n                        //console.log(queryData);\r\n                        break;\r\n                    case 5:\r\n                        if (!date) {\r\n                            this.$message(\'比较基础日期不能为空！\');\r\n                            return;\r\n                        }\r\n                        if (!months) {\r\n                            this.$message(\'请选择往前同期的月数！\');\r\n                            return;\r\n                        }\r\n                        //console.log(\'月同期\', date, months);\r\n                        startMonthDate = this.getPreMonthDay(date, months);\r\n                        queryData = {\r\n                            category: category,\r\n                            customType: customType,\r\n                            attribute: attribute,\r\n                            startDate: startMonthDate,\r\n                            endDate: this.formatDate(date, \'yyyy-MM-dd\'),\r\n                        };\r\n                        //console.log(queryData);\r\n                        break;\r\n                    default:\r\n                        break;\r\n                }\r\n                //根据查询客群类别和属性更新图表title\r\n                //this.setTitle(customerType, attribute);\r\n\r\n//                if(this.chartType ==\'series\'){\r\n//                    if(seriesStep){\r\n//                    queryData.step = seriesStep;\r\n//                  }else{\r\n//                    this.$message(\'请设定统计的划分刻度值！\');\r\n//                    return;\r\n//                  }\r\n//                }\r\n\r\n                this.$refs.line.showLoading({\r\n                    text: \'正在加载\',\r\n                    color: \'#4ea397\',\r\n                    maskColor: \'rgba(255, 255, 255, 0.4)\'\r\n                });\r\n\r\n                Common.ajax({\r\n                    url: "/web/v1/statistic/query",\r\n                    type: \'post\',\r\n                    contentType: "application/json",\r\n                    data: queryData,\r\n                    success: (response) => {\r\n                        this.$refs.line.hideLoading();\r\n                        let resData;\r\n                        this.clearLine();\r\n                        if (response.data && response.data.list) {\r\n                            resData = response.data;\r\n                            if (!response.status) {\r\n                                if (this.chartType == \'hash\') {\r\n                                    this.setOptions(resData.categories, resData.dates);\r\n                                    resData.list.forEach((item, index, arr) => {\r\n                                        let idx = this.lineGroup[item.category];\r\n                                        let dataIdx = this.line.xAxis[0].data.indexOf(item.date);\r\n                                        this.line.series[idx].data[dataIdx] = item.value;\r\n//                                      //console.log(\'idx:\',idx,\'dataIdx:\',dataIdx,item.value,this.percentSeriesArr);\r\n                                        //保存为切换百分比模式处理数据\r\n                                        this.extractPercentSeriesArr(dataIdx, item);\r\n//                                      //console.log(\'this.percentSeriesArr\',this.percentSeriesArr);\r\n                                    });\r\n\r\n                                    //格式化周和月的横坐标显示\r\n                                    this.formatHashxAxisData(category);\r\n\r\n                                    //设置百分比模式的配置options\r\n                                    this.setPercentOptions();\r\n\r\n                                } else {\r\n                                    this.setOptions(resData.dates, resData.categories, category);\r\n                                    resData.list.forEach((item, index, arr) => {\r\n                                        let idx = this.lineGroup[this.formatSeriesAndLegend(category, item.date)];\r\n                                        let dataIdx = this.line.xAxis[0].data.indexOf(item.category);\r\n                                        this.line.series[idx].data[dataIdx] = item.value;\r\n                                    });\r\n                                    //this.formatSeriesxAxisData(category);\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    error: (err) => {\r\n                        this.$refs.line.hideLoading();\r\n                        let error = err.message || err;\r\n                        Notification.error({\r\n                            title: \'错误\',\r\n                            message: error\r\n                        });\r\n                    },\r\n                });\r\n            },\r\n            handleClick(tab, event) {\r\n                let index = tab.index;\r\n                if (index == 0) {\r\n                    this.activeName = \'first\';\r\n                }\r\n            },\r\n            handleCategoryChange(value){\r\n                console.dir(this.searchParam);\r\n            },\r\n            handleAttributeChange(value){\r\n\r\n                //根据属性更换对应图形类型\r\n                if (this.hashes.indexOf(value) >= 0) {\r\n                    this.chartType = \'hash\';\r\n                } else {\r\n                    this.chartType = \'series\';\r\n                }\r\n                //console.log(\'attribute:\', value, this.hashes, this.chartType);\r\n                this.showPercent = false;\r\n            },\r\n            switchPercent(value){\r\n              if(!this.percentLineOptions.series){\r\n                this.$message(\'请重新查询后再切换百分比模式！\');\r\n                this.clearLine();\r\n              \treturn;\r\n\r\n              }\r\n            \tif(!this.line.series.length) return;\r\n                if (value) {\r\n                    this.noPercentOptions = deepcopy(this.line);\r\n                    this.line = this.percentLineOptions;\r\n                } else {\r\n                    this.line = this.noPercentOptions;\r\n                }\r\n            },\r\n        },\r\n        created(){\r\n\r\n        },\r\n        mounted(){\r\n            let cvHeight = $(\'.contents\').height() - 180;\r\n            $(\'.chartClass\').css(\'height\', cvHeight)//.find(\'canvas\').css(\'height\',cvHeight).parent(\'div\').css(\'height\',cvHeight);\r\n            //调用echarts实例resize函数\r\n            this.$refs.line.resize();\r\n\r\n            let line = this.$refs.line;\r\n            line.showLoading({\r\n                text: \'正在加载\',\r\n                color: \'#4ea397\',\r\n                maskColor: \'rgba(255, 255, 255, 0.4)\'\r\n            });\r\n//            this.getCustomerTypes();\r\n//          this.getDevices();\r\n            this.getAttributes();\r\n            //this.search();\r\n            line.hideLoading();\r\n        },\r\n        beforeDestroy(){\r\n        \tthis.clearLine();\r\n        },\r\n        watch: {\r\n            weeks: function (value, oldValue) {\r\n                function isInteger(obj) {\r\n                    return parseInt(obj, 10) === obj\r\n                }\r\n\r\n                if (!isInteger(value)) {\r\n                    this.$refs.weeks.setCurrentValue(parseInt(value, 10));\r\n                }\r\n            },\r\n            months: function (value, oldValue) {\r\n                function isInteger(obj) {\r\n                    return parseInt(obj, 10) === obj\r\n                }\r\n\r\n                if (!isInteger(value)) {\r\n                    this.$refs.months.setCurrentValue(parseInt(value, 10));\r\n                }\r\n\r\n            }\r\n        },\r\n    }\r\n<\/script>\r\n']}])}}]);
//# sourceMappingURL=63.6a4a1aaf57bd34e7e0e8.js.map