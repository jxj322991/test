(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1030:function(e,r,n){"use strict";n.r(r);var t=n(11),a=n.n(t),s=n(2),l=n(9),o=n(8),i=(n(506),n(3)),m=Object(i.a)({data:function(){return{allPermissions:[],rolePermissions:[],defaultProps:{children:"childTree",label:"name"},expandAll:!0}},props:["permTree","roleId","roleName"],methods:{hoverRolePermissions:function(e){var r=this;console.log(123),s.a.ajax({url:"/web/v1/permission/getTreeByRole",type:"POST",dataType:"json",contentType:"application/json",data:{roleId:e},success:function(e){r.rolePermissions=e.data?e.data.permissions:"",r.$refs.tree.setCheckedKeys(r.rolePermissions)},error:function(e){r.$message({message:e.message,type:"warning"})}})}}},function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("span",{staticClass:"pop-container"},[n("el-popover",{ref:"popover",attrs:{placement:"top-start",width:"350",trigger:"click"}},[n("h2",{staticClass:"role-name"},[e._v("报表权限："+e._s(e.roleName))]),e._v(" "),n("el-tree",{ref:"tree",staticClass:"self-tree",attrs:{data:e.permTree,"show-checkbox":"","node-key":"id","default-expand-all":e.expandAll,"default-checked-keys":e.rolePermissions,props:e.defaultProps}})],1),e._v(" "),n("el-button",{directives:[{name:"popover",rawName:"v-popover:popover",arg:"popover"}],staticClass:"detail-info",attrs:{type:"text",size:"mini",icon:"information"},on:{click:function(){return e.hoverRolePermissions(e.roleId)}}},[e._v("详情")])],1)},[],!1,null,"468068b6",null).exports,c=(n(508),Object(i.a)({props:["editUserDialogVisible","editDialogClosed","preEmail","addOrEdit","rolesMenu"],data:function(){return{addUserDialogVisible:!1,form:{name:"",email:"",roleId:"",id:""},rules:{name:[{required:!0,message:"请输入用户名称",trigger:"blur"},{max:50,message:"长度最多50个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur,change"}],roleId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]},formLabelWidth:"60px",permTree:[{name:"",parentId:"",childPerms:[{name:""}]}],rolePermissions:[]}},components:{rolePermissions:m},computed:{disabled:function(){return!this.addOrEdit.status}},mounted:function(){this.getMenu()},methods:{closeDialog:function(){this.$refs.ruleForm.resetFields(),this.form={name:"",email:"",roleId:"",id:""},this.$emit("editDialogClosed")},getUserInfo:function(){var e=this;s.a.ajax({url:"/web/v1/user/query",type:"POST",dataType:"json",contentType:"application/json",data:{email:this.preEmail},success:function(r){var n=r.data;n&&(e.form.roleId=n.roleId,e.form.name=n.name,e.form.email=n.email,e.form.id=n.id)},error:function(r){e.$message({message:r.message,type:"warning"})}})},addOrEditFn:function(e){var r=this,n=void 0;return this.form.name?this.form.email?this.form.roleId?(n=1==e?"/web/v1/user/add":"/web/v1/user/edit",void s.a.ajax({url:n,type:"post",data:{email:this.form.email,name:this.form.name,roleId:this.form.roleId},dataType:"json",contentType:"application/json",success:function(e){r.$alert(e.message,"",{type:"success",confirmButtonText:"知道了",callback:function(){r.closeDialog()}})},error:function(e){r.$message({message:e.message,type:"warning"})}})):(this.$message("请选择用户角色"),!1):(this.$message("请输入用户邮箱"),!1):(this.$message("请输入用户名称"),!1)},getMenu:function(){var e=this;s.a.ajax({url:"/web/v1/permission/getTree/true",type:"POST",dataType:"json",success:function(r){e.permTree=r.data?r.data.list:""},error:function(r){e.$message({message:r.message,type:"warning"})}})}},watch:{editUserDialogVisible:function(e){e&&this.preEmail&&this.getUserInfo()},preEmail:function(e){this.form.email=e}}},function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("el-dialog",{attrs:{title:e.addOrEdit.dialogTitle,width:"50%","show-close":!1,"close-on-click-modal":!1},on:{close:e.closeDialog},model:{value:e.editUserDialogVisible,callback:function(r){e.editUserDialogVisible=r},expression:"editUserDialogVisible"}},[n("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[n("el-form-item",{attrs:{label:"邮箱",prop:"email","label-width":e.formLabelWidth}},[n("el-input",{attrs:{disabled:e.disabled,"auto-complete":"off"},model:{value:e.form.email,callback:function(r){e.$set(e.form,"email",r)},expression:"form.email"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"姓名",prop:"name","label-width":e.formLabelWidth}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.form.name,callback:function(r){e.$set(e.form,"name",r)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"角色",prop:"roleId","label-width":e.formLabelWidth}},[n("el-radio-group",{model:{value:e.form.roleId,callback:function(r){e.$set(e.form,"roleId",r)},expression:"form.roleId"}},e._l(e.rolesMenu,function(r){return n("div",{key:r.value},[n("el-radio",{key:r.value,attrs:{label:r.value}},[e._v("\n            "+e._s(r.label)+"\n            "),n("role-permissions",{attrs:{permTree:e.permTree,roleId:r.value,roleName:r.label}})],1)],1)}),0)],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.closeDialog}},[e._v("  取消  ")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(){return e.addOrEditFn(e.addOrEdit.status)}}},[e._v("  "+e._s(e.addOrEdit.dialogBtn)+"  ")])],1)],1)},[],!1,null,"7c10cbb6",null).exports),d={components:{DataTable:l.a,TabPage:o.a,EditUser:c,Common:s.a},data:function(){return{addOrEdit:{status:"",dialogTitle:"",dialogBtn:""},editUserDialogVisible:!1,preEmail:"",dataTable:{pageSize:30,pageSizes:[30,60,90,100],url:"/web/v1/user/queryRoleUsers",queryParams:{},emptyText:"没有记录"},queryParams:{name:"",email:"",roleId:""},roles:[]}},filters:{statusFilter:function(e){return{0:"success",1:"error"}[e]}},mounted:function(){this.$refs.tabPage.openTabPage({label:"用户管理",name:"userManage",slotName:"userManage",closable:!1}),this.getRoles()},methods:{search:function(){a()(this.dataTable.queryParams,this.queryParams),this.$refs.dataTable.$emit("load-data")},resetForm:function(){this.$refs.ruleForm.resetFields()},getRoles:function(){var e=this;s.a.ajax({url:"/web/v1/role/menu",type:"post",dataType:"json",contentType:"application/json",success:function(r){e.roles=r.data.list},error:function(r){e.$message({message:r.message,type:"warning"})}})},openEditPage:function(e,r){this.editUserDialogVisible=!0,this.preEmail=e.email||"",this.addOrEdit.status=r,this.addOrEdit.dialogTitle=r?"新建":"编辑",this.addOrEdit.dialogBtn=r?"确定":"保存"},openPasswordPage:function(e){var r=this;this.$confirm("是否确认重置密码?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){s.a.ajax({url:"/web/v1/user/initUserPassword",type:"post",dataType:"json",data:{email:e.email},contentType:"application/json",success:function(){var e=this;r.$alert("重置成功","",{type:"success",confirmButtonText:"知道了",callback:function(){r.$refs.dataTable.$emit("load-data"),r.$refs.history&&e.$refs.history.$emit("load-data")}})},error:function(e){r.$message({message:e.message,type:"warning"})}})}).catch(function(){})},openDeletePage:function(e){var r=this;this.$confirm("是否确认删除用户?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(function(){s.a.ajax({url:"/web/v1/user/delete",type:"post",data:{id:e.id},contentType:"application/json",success:function(){var e=this;r.$alert("删除成功","",{type:"success",confirmButtonText:"知道了",callback:function(){r.$refs.dataTable.$emit("load-data"),r.$refs.history&&e.$refs.history.$emit("load-data")}})},error:function(e){r.$message({message:e.message,type:"warning"})}})}).catch(function(){})},editDialogClosed:function(){this.editUserDialogVisible=!1,this.preEmail="",this.$refs.dataTable.$emit("load-data")}}},p=(n(510),Object(i.a)(d,function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("tab-page",{ref:"tabPage"},[n("template",{slot:"userManage"},[n("data-table",{ref:"dataTable",staticStyle:{width:"100%"},attrs:{"data-table":e.dataTable}},[n("div",{attrs:{slot:"conditions"},slot:"conditions"},[n("el-form",{ref:"ruleForm",staticStyle:{width:"80%",float:"left"},attrs:{inline:!0,model:e.queryParams}},[n("el-form-item",{attrs:{prop:"name"}},[n("el-input",{attrs:{placeholder:"姓名",size:"small"},model:{value:e.queryParams.name,callback:function(r){e.$set(e.queryParams,"name",r)},expression:"queryParams.name"}})],1),e._v(" "),n("el-form-item",{attrs:{prop:"email"}},[n("el-input",{attrs:{placeholder:"邮箱",size:"small"},model:{value:e.queryParams.email,callback:function(r){e.$set(e.queryParams,"email",r)},expression:"queryParams.email"}})],1),e._v(" "),n("el-form-item",{attrs:{prop:"roleId"}},[n("el-select",{attrs:{clearable:"",placeholder:"角色"},model:{value:e.queryParams.roleId,callback:function(r){e.$set(e.queryParams,"roleId",r)},expression:"queryParams.roleId"}},e._l(e.roles,function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.search}},[e._v("  查询  ")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.resetForm}},[e._v("  重置   ")])],1)],1),e._v(" "),n("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:function(){return e.openEditPage(0,1)}}},[e._v("  新建   ")])],1),e._v(" "),n("template",{slot:"columns"},[n("el-table-column",{staticStyle:{width:"6%"},attrs:{prop:"id",label:"序号"}}),e._v(" "),n("el-table-column",{staticStyle:{width:"10%"},attrs:{prop:"name",label:"姓名"}}),e._v(" "),n("el-table-column",{staticStyle:{width:"12%"},attrs:{prop:"email",label:"邮箱"}}),e._v(" "),n("el-table-column",{staticStyle:{width:"12%"},attrs:{prop:"roleName",label:"角色"}}),e._v(" "),n("el-table-column",{attrs:{label:"状态",width:"90"},scopedSlots:e._u([{key:"default",fn:function(r){return[n("el-tag",{attrs:{type:e._f("statusFilter")(r.row.flag)}},[e._v(e._s(0==r.row.flag?"使用中":"已失效"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"密码状态",width:"90"},scopedSlots:e._u([{key:"default",fn:function(r){return[n("el-tag",{attrs:{type:e._f("statusFilter")(r.row.isReset)}},[e._v(e._s(0==r.row.isReset?"正常":"已重置"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(r){return[n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(){return e.openEditPage(r.row,0)}}},[e._v("编辑")]),e._v(" "),n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(){return e.openPasswordPage(r.row)}}},[e._v("密码重置")]),e._v(" "),n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(){return e.openDeletePage(r.row)}}},[e._v("删除")])]}}])})],1)],2),e._v(" "),n("edit-user",{attrs:{editUserDialogVisible:e.editUserDialogVisible,rolesMenu:e.roles,preEmail:e.preEmail,addOrEdit:e.addOrEdit},on:{editDialogClosed:e.editDialogClosed}})],1)],2)},[],!1,null,"4d0afb08",null));r.default=p.exports},153:function(e,r,n){var t=n(507);"string"==typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);(0,n(5).default)("ab9da14c",t,!0,{})},154:function(e,r,n){var t=n(509);"string"==typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);(0,n(5).default)("7db44a0f",t,!0,{})},155:function(e,r,n){var t=n(511);"string"==typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);(0,n(5).default)("1f19d1e4",t,!0,{})},506:function(e,r,n){"use strict";var t=n(153);n.n(t).a},507:function(e,r,n){(e.exports=n(4)(!0)).push([e.i,"\n.role-name[data-v-468068b6]{\n    margin: 5px;\n    margin-bottom: 10px;\n    text-decoration: underline;\n}\n.el-tree[data-v-468068b6]{\n    border:none;\n}\n.checkbox1[data-v-468068b6], ul[data-v-468068b6] {\n    overflow: hidden;\n}\n.checkbox1 li[data-v-468068b6] {\n    float: left;\n    margin-right: 15px;\n    width: 150px;\n}\n.checkbox1 .el-checkbox-group .el-checkbox[data-v-468068b6] {\n    height: 20px;\n    line-height: 20px;\n    margin-bottom: 0px;\n    display: block;\n    border-left: 1px solid #000;\n    padding-left: 5px;\n}\n.checkbox1 .el-checkbox-group .firstCheckbox[data-v-468068b6] {\n    border-left: none;\n}\n.checkbox1 .el-checkbox-group .secondCheckbox[data-v-468068b6] {\n    margin-left: 12px;\n}\n.detail-info[data-v-468068b6]{\n    margin-top: -5px ;\n}\n","",{version:3,sources:["src/components/showRolePermissions.vue"],names:[],mappings:";AAsFA;IACA,WAAA;IACA,mBAAA;IACA,0BAAA;AACA;AACA;IACA,WAAA;AACA;AACA;IACA,gBAAA;AACA;AAEA;IACA,WAAA;IACA,kBAAA;IACA,YAAA;AACA;AAEA;IACA,YAAA;IACA,iBAAA;IACA,kBAAA;IACA,cAAA;IACA,2BAAA;IACA,iBAAA;AACA;AAEA;IACA,iBAAA;AACA;AAEA;IACA,iBAAA;AACA;AACA;IACA,iBAAA;AACA",file:"showRolePermissions.vue?vue&type=style&index=0&id=468068b6&scoped=true&lang=css&",sourcesContent:['<template>\r\n    <span class="pop-container">\r\n        <el-popover ref="popover" placement="top-start" width="350" trigger="click">\r\n            <h2 class="role-name">报表权限：{{roleName}}</h2>\r\n            \x3c!--<div class="checkbox1">--\x3e\r\n                \x3c!--<el-checkbox-group v-model="rolePermissions">--\x3e\r\n                    \x3c!--<ul>--\x3e\r\n                        \x3c!--<li v-for="perms1 in permTree">--\x3e\r\n                            \x3c!--<el-checkbox :label="perms1.id" :key="perms1.id" disabled class="firstCheckbox">--\x3e\r\n                                \x3c!--{{perms1.name}}--\x3e\r\n                            \x3c!--</el-checkbox>--\x3e\r\n                            \x3c!--<template v-if="perms1.type == \'MENU\'">--\x3e\r\n                                \x3c!--<template v-for="perms2 in perms1.childTree">--\x3e\r\n                                    \x3c!--<el-checkbox :label="perms2.id" :key="perms2.id" disabled class="secondCheckbox">--\x3e\r\n                                        \x3c!--{{perms2.name}}--\x3e\r\n                                    \x3c!--</el-checkbox>--\x3e\r\n                                    \x3c!--<template v-if="perms2.type == \'MENU\'">--\x3e\r\n                                        \x3c!--<el-checkbox v-for="perms3 in perms2.childPerms" :key="perms3.id"--\x3e\r\n                                                     \x3c!--:label="perms3.id" disabled--\x3e\r\n                                                     \x3c!--class="thirdCheckbox">{{perms3.name}}--\x3e\r\n                                        \x3c!--</el-checkbox>--\x3e\r\n                                    \x3c!--</template>--\x3e\r\n                                \x3c!--</template>--\x3e\r\n                            \x3c!--</template>--\x3e\r\n                        \x3c!--</li>--\x3e\r\n                    \x3c!--</ul>--\x3e\r\n                \x3c!--</el-checkbox-group>--\x3e\r\n            \x3c!--</div>--\x3e\r\n            <el-tree\r\n                class="self-tree"\r\n                ref="tree"\r\n                :data="permTree"\r\n                show-checkbox\r\n                node-key="id"\r\n                :default-expand-all="expandAll"\r\n                :default-checked-keys="rolePermissions"\r\n                :props="defaultProps">\r\n                </el-tree>\r\n        </el-popover>\r\n        <el-button type="text" size="mini" class="detail-info" icon="information" v-popover:popover\r\n                   @click="hoverRolePermissions(roleId)">详情</el-button>\r\n    </span>\r\n</template>\r\n<script>\r\n    import Common from \'../utils/common\'\r\n    export default{\r\n        data(){\r\n            return {\r\n            \tallPermissions:[],\r\n                rolePermissions: [],\r\n                defaultProps: {\r\n                    children: \'childTree\',\r\n                    label: \'name\'\r\n                },\r\n                expandAll:true,\r\n            }\r\n        },\r\n        props: [\'permTree\',\'roleId\',\'roleName\'],\r\n\r\n        methods: {\r\n            hoverRolePermissions(id){\r\n                console.log(123);\r\n                Common.ajax({\r\n                    url: \'/web/v1/permission/getTreeByRole\',\r\n                    type: \'POST\',\r\n                    dataType: \'json\',\r\n                    contentType: "application/json",\r\n                    data: {\r\n                        roleId: id\r\n                    },\r\n                    success: (response) => {\r\n                        this.rolePermissions = response.data ? response.data.permissions : \'\';\r\n                        this.$refs.tree.setCheckedKeys(this.rolePermissions);\r\n                    },\r\n                    error: (response) => {\r\n                        this.$message({\r\n                            message: response.message,\r\n                            type: \'warning\'\r\n                        });\r\n                    }\r\n                });\r\n            },\r\n        },\r\n    }\r\n<\/script>\r\n<style scoped>\r\n    .role-name{\r\n        margin: 5px;\r\n        margin-bottom: 10px;\r\n        text-decoration: underline;\r\n    }\r\n    .el-tree{\r\n        border:none;\r\n    }\r\n    .checkbox1, ul {\r\n        overflow: hidden;\r\n    }\r\n\r\n    .checkbox1 li {\r\n        float: left;\r\n        margin-right: 15px;\r\n        width: 150px;\r\n    }\r\n\r\n    .checkbox1 .el-checkbox-group .el-checkbox {\r\n        height: 20px;\r\n        line-height: 20px;\r\n        margin-bottom: 0px;\r\n        display: block;\r\n        border-left: 1px solid #000;\r\n        padding-left: 5px;\r\n    }\r\n\r\n    .checkbox1 .el-checkbox-group .firstCheckbox {\r\n        border-left: none;\r\n    }\r\n\r\n    .checkbox1 .el-checkbox-group .secondCheckbox {\r\n        margin-left: 12px;\r\n    }\r\n    .detail-info{\r\n        margin-top: -5px ;\r\n    }\r\n</style>\r\n']}])},508:function(e,r,n){"use strict";var t=n(154);n.n(t).a},509:function(e,r,n){(e.exports=n(4)(!0)).push([e.i,"\n.el-dialog__header[data-v-7c10cbb6] {\r\n  padding: 20px 20px 0;\r\n  text-align: center;\n}\n.el-radio-group .el-radio[data-v-7c10cbb6] {\r\n  display: block;\r\n  margin: 5px 0;\n}\n.checkbox1[data-v-7c10cbb6],\r\nul[data-v-7c10cbb6] {\r\n  overflow: hidden;\n}\n.checkbox1 li[data-v-7c10cbb6] {\r\n  float: left;\r\n  margin-right: 15px;\r\n  width: 100px;\n}\n.checkbox1 .el-checkbox-group .el-checkbox[data-v-7c10cbb6] {\r\n  height: 20px;\r\n  line-height: 20px;\r\n  margin-bottom: 0px;\r\n  display: block;\r\n  border-left: 1px solid #000;\r\n  padding-left: 5px;\n}\n.checkbox1 .el-checkbox-group .firstCheckbox[data-v-7c10cbb6] {\r\n  border-left: none;\n}\n.checkbox1 .el-checkbox-group .secondCheckbox[data-v-7c10cbb6] {\r\n  margin-left: 12px;\n}\r\n","",{version:3,sources:["src/views/contents/permission/editUserDialog.vue"],names:[],mappings:";AAyDA;EACA,oBAAA;EACA,kBAAA;AACA;AAEA;EACA,cAAA;EACA,aAAA;AACA;AAEA;;EAEA,gBAAA;AACA;AAEA;EACA,WAAA;EACA,kBAAA;EACA,YAAA;AACA;AAEA;EACA,YAAA;EACA,iBAAA;EACA,kBAAA;EACA,cAAA;EACA,2BAAA;EACA,iBAAA;AACA;AAEA;EACA,iBAAA;AACA;AAEA;EACA,iBAAA;AACA",file:"editUserDialog.vue?vue&type=style&index=0&id=7c10cbb6&scoped=true&lang=css&",sourcesContent:['\x3c!--\r\n * @Description: \r\n * @Author: jinxiaojian\r\n * @Email: jinxiaojian@youxin.com\r\n * @Date: 2019-07-12 16:17:33\r\n * @LastEditTime: 2019-07-16 16:57:52\r\n * @LastEditors: 靳肖健\r\n --\x3e\r\n<template>\r\n  <el-dialog\r\n    :title="addOrEdit.dialogTitle"\r\n    v-model="editUserDialogVisible"\r\n    width="50%"\r\n    :show-close="false"\r\n    @close="closeDialog"\r\n    :close-on-click-modal="false"\r\n  >\r\n    <el-form :model="form" :rules="rules" ref="ruleForm">\r\n      <el-form-item label="邮箱" prop="email" :label-width="formLabelWidth">\r\n        \x3c!--<template v-if="addOrEdit.status == 0">--\x3e\r\n        \x3c!--<span>{{preEmail}}</span>--\x3e\r\n        \x3c!--</template>--\x3e\r\n        \x3c!--<template v-if="addOrEdit.status == 1">--\x3e\r\n        \x3c!--<el-input v-model="form.email" auto-complete="off"></el-input>--\x3e\r\n        \x3c!--</template>--\x3e\r\n        <el-input v-model="form.email" :disabled="disabled" auto-complete="off"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label="姓名" prop="name" :label-width="formLabelWidth">\r\n        <el-input v-model="form.name" auto-complete="off"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label="角色" prop="roleId" :label-width="formLabelWidth">\r\n        <el-radio-group v-model="form.roleId">\r\n          <div v-for="item in rolesMenu" :key="item.value">\r\n            <el-radio :key="item.value" :label="item.value">\r\n              {{item.label}}\r\n              <role-permissions :permTree="permTree" :roleId="item.value" :roleName="item.label"></role-permissions>\r\n            </el-radio>\r\n          </div>\r\n\r\n          \x3c!--<el-radio v-for="item in rolesMenu" :key="item.value"--\x3e\r\n          \x3c!--:label="item.value" v-popover:popover >--\x3e\r\n          \x3c!--{{item.label}}--\x3e\r\n          \x3c!--</el-radio>--\x3e\r\n        </el-radio-group>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <div slot="footer" class="dialog-footer">\r\n      <el-button @click="closeDialog">&nbsp;&nbsp;取消&nbsp;&nbsp;</el-button>\r\n      <el-button\r\n        type="primary"\r\n        @click="addOrEditFn(addOrEdit.status)"\r\n      >&nbsp;&nbsp;{{addOrEdit.dialogBtn}}&nbsp;&nbsp;</el-button>\r\n    </div>\r\n  </el-dialog>\r\n</template>\r\n<style scoped>\r\n.el-dialog__header {\r\n  padding: 20px 20px 0;\r\n  text-align: center;\r\n}\r\n\r\n.el-radio-group .el-radio {\r\n  display: block;\r\n  margin: 5px 0;\r\n}\r\n\r\n.checkbox1,\r\nul {\r\n  overflow: hidden;\r\n}\r\n\r\n.checkbox1 li {\r\n  float: left;\r\n  margin-right: 15px;\r\n  width: 100px;\r\n}\r\n\r\n.checkbox1 .el-checkbox-group .el-checkbox {\r\n  height: 20px;\r\n  line-height: 20px;\r\n  margin-bottom: 0px;\r\n  display: block;\r\n  border-left: 1px solid #000;\r\n  padding-left: 5px;\r\n}\r\n\r\n.checkbox1 .el-checkbox-group .firstCheckbox {\r\n  border-left: none;\r\n}\r\n\r\n.checkbox1 .el-checkbox-group .secondCheckbox {\r\n  margin-left: 12px;\r\n}\r\n</style>\r\n<style>\r\n</style>\r\n<script>\r\nimport Common from "../../../utils/common";\r\nimport rolePermissions from "../../../components/showRolePermissions.vue";\r\nexport default {\r\n  props: [\r\n    "editUserDialogVisible",\r\n    "editDialogClosed",\r\n    "preEmail",\r\n    "addOrEdit",\r\n    "rolesMenu",\r\n  ],\r\n  data() {\r\n    return {\r\n      addUserDialogVisible: false,\r\n      form: {\r\n        name: "",\r\n        email: "",\r\n        roleId: "",\r\n        id: "",\r\n      },\r\n      rules: {\r\n        name: [\r\n          { required: true, message: "请输入用户名称", trigger: "blur" },\r\n          { max: 50, message: "长度最多50个字符", trigger: "blur" },\r\n        ],\r\n        email: [\r\n          { required: true, message: "请输入邮箱地址", trigger: "blur" },\r\n          {\r\n            type: "email",\r\n            message: "请输入正确的邮箱地址",\r\n            trigger: "blur,change",\r\n          },\r\n        ],\r\n        roleId: [\r\n          { required: true, message: "请选择用户角色", trigger: "blur" },\r\n        ],\r\n      },\r\n      formLabelWidth: "60px",\r\n      permTree: [\r\n        {\r\n          //权限树\r\n          name: "",\r\n          parentId: "",\r\n          childPerms: [\r\n            {\r\n              name: "",\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n      rolePermissions: [],\r\n    };\r\n  },\r\n  components: {\r\n    rolePermissions,\r\n  },\r\n  computed: {\r\n    disabled: function() {\r\n      return !this.addOrEdit.status;\r\n    },\r\n  },\r\n  mounted() {\r\n    this.getMenu();\r\n  },\r\n  methods: {\r\n    closeDialog() {\r\n      this.$refs["ruleForm"].resetFields();\r\n      this.form = {\r\n        name: "",\r\n        email: "",\r\n        roleId: "",\r\n        id: "",\r\n      };\r\n      this.$emit("editDialogClosed");\r\n    },\r\n\r\n    getUserInfo() {\r\n      Common.ajax({\r\n        url: "/web/v1/user/query",\r\n        type: "POST",\r\n        dataType: "json",\r\n        contentType: "application/json",\r\n        data: {\r\n          email: this.preEmail,\r\n        },\r\n        success: response => {\r\n          let result = response.data;\r\n          if (result) {\r\n            this.form.roleId = result.roleId;\r\n            this.form.name = result.name;\r\n            this.form.email = result.email;\r\n            this.form.id = result.id;\r\n          }\r\n        },\r\n        error: response => {\r\n          this.$message({\r\n            message: response.message,\r\n            type: "warning",\r\n          });\r\n        },\r\n      });\r\n    },\r\n\r\n    addOrEditFn(flag) {\r\n      let url;\r\n      if (!this.form.name) {\r\n        this.$message("请输入用户名称");\r\n        return false;\r\n      }\r\n      if (!this.form.email) {\r\n        this.$message("请输入用户邮箱");\r\n        return false;\r\n      }\r\n      if (!this.form.roleId) {\r\n        this.$message("请选择用户角色");\r\n        return false;\r\n      }\r\n      if (flag == 1) {\r\n        //新建\r\n        url = "/web/v1/user/add";\r\n      } else {\r\n        url = "/web/v1/user/edit";\r\n      }\r\n      Common.ajax({\r\n        url: url,\r\n        type: "post",\r\n        data: {\r\n          email: this.form.email,\r\n          name: this.form.name,\r\n          roleId: this.form.roleId,\r\n        },\r\n        dataType: "json",\r\n        contentType: "application/json",\r\n        success: response => {\r\n          this.$alert(response.message, "", {\r\n            type: "success",\r\n            confirmButtonText: "知道了",\r\n            callback: action => {\r\n              this.closeDialog();\r\n            },\r\n          });\r\n        },\r\n        error: response => {\r\n          this.$message({\r\n            message: response.message,\r\n            type: "warning",\r\n          });\r\n        },\r\n      });\r\n    },\r\n\r\n    getMenu() {\r\n      Common.ajax({\r\n        url: "/web/v1/permission/getTree/true",\r\n        type: "POST",\r\n        dataType: "json",\r\n        success: response => {\r\n          this.permTree = response.data ? response.data.list : "";\r\n        },\r\n        error: response => {\r\n          this.$message({\r\n            message: response.message,\r\n            type: "warning",\r\n          });\r\n        },\r\n      });\r\n    },\r\n  },\r\n  watch: {\r\n    editUserDialogVisible: function(val) {\r\n      if (val && this.preEmail) {\r\n        this.getUserInfo();\r\n      }\r\n    },\r\n    preEmail: function(val) {\r\n      this.form.email = val;\r\n    },\r\n  },\r\n};\r\n<\/script>\r\n']}])},510:function(e,r,n){"use strict";var t=n(155);n.n(t).a},511:function(e,r,n){(e.exports=n(4)(!0)).push([e.i,"\n.el-table th > .cell[data-v-4d0afb08] {\r\n  text-align: center;\n}\n.create[data-v-4d0afb08] {\r\n  float: right;\r\n  margin-bottom: 20px;\n}\n.mb-10[data-v-4d0afb08] {\r\n  margin-bottom: 10px;\n}\r\n","",{version:3,sources:["src/views/contents/permission/userManage.vue"],names:[],mappings:";AA8EA;EACA,kBAAA;AACA;AAEA;EACA,YAAA;EACA,mBAAA;AACA;AAEA;EACA,mBAAA;AACA",file:"userManage.vue?vue&type=style&index=0&id=4d0afb08&scoped=true&lang=css&",sourcesContent:['\x3c!--\r\n * @Description: \r\n * @Author: 焦丙乾(jiaobingqian)\r\n * @Email: jiaobq123@163.com\r\n * @Date: 2019-07-15 18:33:54\r\n * @LastEditTime: 2019-07-17 19:41:38\r\n * @LastEditors: 王娇(wangjiao)\r\n --\x3e\r\n<template>\r\n  <tab-page ref="tabPage">\r\n    <template slot="userManage">\r\n      <data-table :data-table="dataTable" ref="dataTable" style="width: 100%">\r\n        <div slot="conditions">\r\n          <el-form :inline="true" ref="ruleForm" :model="queryParams" style="width:80%;float:left;">\r\n            <el-form-item prop="name">\r\n              <el-input v-model="queryParams.name" placeholder="姓名" size="small"></el-input>\r\n            </el-form-item>\r\n            <el-form-item prop="email">\r\n              <el-input v-model="queryParams.email" placeholder="邮箱" size="small"></el-input>\r\n            </el-form-item>\r\n            <el-form-item prop="roleId">\r\n              <el-select v-model="queryParams.roleId" clearable placeholder="角色">\r\n                <el-option\r\n                  v-for="item in roles"\r\n                  :key="item.value"\r\n                  :label="item.label"\r\n                  :value="item.value"\r\n                ></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button type="primary" @click="search" size="small">&nbsp;&nbsp;查询&nbsp;&nbsp;</el-button>\r\n              <el-button type="primary" @click="resetForm" size="small">&nbsp;&nbsp;重置 &nbsp;&nbsp;</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n          <el-button\r\n            type="primary"\r\n            size="small"\r\n            @click="openEditPage(0,1)"\r\n            style="float:right;"\r\n          >&nbsp;&nbsp;新建 &nbsp;&nbsp;</el-button>\r\n        </div>\r\n\r\n        <template slot="columns">\r\n          <el-table-column prop="id" label="序号" style="width: 6%"></el-table-column>\r\n          <el-table-column prop="name" label="姓名" style="width: 10%"></el-table-column>\r\n          <el-table-column prop="email" label="邮箱" style="width: 12%"></el-table-column>\r\n          <el-table-column prop="roleName" label="角色" style="width: 12%"></el-table-column>\r\n          <el-table-column label="状态" width="90">\r\n            <template slot-scope="scope">\r\n              <el-tag :type="scope.row.flag | statusFilter">{{scope.row.flag == 0?\'使用中\':\'已失效\'}}</el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label="密码状态" width="90">\r\n            <template slot-scope="scope">\r\n              <el-tag :type="scope.row.isReset | statusFilter">{{scope.row.isReset == 0?\'正常\':\'已重置\'}}</el-tag>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label="操作">\r\n            <template slot-scope="scope">\r\n              <el-button type="text" size="small" @click="openEditPage(scope.row,0)">编辑</el-button>\r\n              <el-button type="text" size="small" @click="openPasswordPage(scope.row)">密码重置</el-button>\r\n              <el-button type="text" size="small" @click="openDeletePage(scope.row)">删除</el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </template>\r\n      </data-table>\r\n      <edit-user\r\n        :editUserDialogVisible="editUserDialogVisible"\r\n        v-on:editDialogClosed="editDialogClosed"\r\n        :rolesMenu="roles"\r\n        :preEmail="preEmail"\r\n        :addOrEdit="addOrEdit"\r\n      ></edit-user>\r\n    </template>\r\n  </tab-page>\r\n</template>\r\n<style scoped>\r\n.el-table th > .cell {\r\n  text-align: center;\r\n}\r\n\r\n.create {\r\n  float: right;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.mb-10 {\r\n  margin-bottom: 10px;\r\n}\r\n</style>\r\n<script>\r\nimport Common from \'../../../utils/common\';\r\nimport DataTable from \'../../../components/DataTable\';\r\nimport TabPage from \'../../../components/TabPage\';\r\nimport EditUser from \'../permission/editUserDialog.vue\';\r\n\r\nexport default {\r\n  components: {\r\n    DataTable,\r\n    TabPage,\r\n    EditUser,\r\n    Common\r\n  },\r\n  data() {\r\n    return {\r\n      addOrEdit: {\r\n        status: \'\',\r\n        dialogTitle: \'\',\r\n        dialogBtn: \'\'\r\n      },\r\n      editUserDialogVisible: false, // 编辑用户窗口\r\n      preEmail: \'\',\r\n      dataTable: {\r\n        pageSize: 30,\r\n        pageSizes: [30, 60, 90, 100],\r\n        url: \'/web/v1/user/queryRoleUsers\',\r\n        queryParams: {},\r\n        emptyText: \'没有记录\'\r\n      },\r\n      queryParams: {\r\n        name: \'\',\r\n        email: \'\',\r\n        roleId: \'\'\r\n      },\r\n      roles: []\r\n    };\r\n  },\r\n  filters: {\r\n    statusFilter(item) {\r\n      const itemsMap = {\r\n        0: \'success\',\r\n        1: \'error\'\r\n      };\r\n      return itemsMap[item];\r\n    }\r\n  },\r\n  mounted() {\r\n    var defaultPage = {\r\n      label: \'用户管理\',\r\n      name: \'userManage\',\r\n      slotName: \'userManage\',\r\n      closable: false\r\n    };\r\n    this.$refs.tabPage.openTabPage(defaultPage);\r\n    this.getRoles();\r\n  },\r\n  methods: {\r\n    search() {\r\n      Object.assign(this.dataTable.queryParams, this.queryParams);\r\n      this.$refs.dataTable.$emit(\'load-data\');\r\n    },\r\n    resetForm() {\r\n      this.$refs.ruleForm.resetFields();\r\n    },\r\n    getRoles() {\r\n      Common.ajax({\r\n        url: \'/web/v1/role/menu\',\r\n        type: \'post\',\r\n        dataType: \'json\',\r\n        contentType: \'application/json\',\r\n        success: response => {\r\n          this.roles = response.data.list;\r\n        },\r\n        error: response => {\r\n          this.$message({\r\n            message: response.message,\r\n            type: \'warning\'\r\n          });\r\n        }\r\n      });\r\n    },\r\n    openEditPage(obj, flag) {\r\n      this.editUserDialogVisible = true;\r\n\r\n      this.preEmail = obj.email || \'\';\r\n\r\n      this.addOrEdit.status = flag;\r\n      this.addOrEdit.dialogTitle = flag ? \'新建\' : \'编辑\';\r\n      this.addOrEdit.dialogBtn = flag ? \'确定\' : \'保存\';\r\n    },\r\n\r\n    openPasswordPage(obj) {\r\n      let self = this;\r\n      this.$confirm(\'是否确认重置密码?\', \'提示\', {\r\n        confirmButtonText: \'确认\',\r\n        cancelButtonText: \'取消\',\r\n        type: \'warning\'\r\n      })\r\n        .then(() => {\r\n          Common.ajax({\r\n            url: \'/web/v1/user/initUserPassword\',\r\n            type: \'post\',\r\n            dataType: \'json\',\r\n            data: { email: obj.email },\r\n            contentType: \'application/json\',\r\n            success(response) {\r\n              self.$alert(\'重置成功\', \'\', {\r\n                type: \'success\',\r\n                confirmButtonText: \'知道了\',\r\n                callback: action => {\r\n                  self.$refs.dataTable.$emit(\'load-data\');\r\n                  self.$refs.history && this.$refs.history.$emit(\'load-data\');\r\n                }\r\n              });\r\n            },\r\n            error(response) {\r\n              self.$message({\r\n                message: response.message,\r\n                type: \'warning\'\r\n              });\r\n            }\r\n          });\r\n        })\r\n        .catch(() => {});\r\n    },\r\n\r\n    openDeletePage(obj) {\r\n      let self = this;\r\n      this.$confirm(\'是否确认删除用户?\', \'提示\', {\r\n        confirmButtonText: \'确认\',\r\n        cancelButtonText: \'取消\',\r\n        type: \'warning\'\r\n      })\r\n        .then(() => {\r\n          Common.ajax({\r\n            url: \'/web/v1/user/delete\',\r\n            type: \'post\',\r\n            data: { id: obj.id },\r\n            contentType: \'application/json\',\r\n            success(response) {\r\n              self.$alert(\'删除成功\', \'\', {\r\n                type: \'success\',\r\n                confirmButtonText: \'知道了\',\r\n                callback: action => {\r\n                  self.$refs.dataTable.$emit(\'load-data\');\r\n                  self.$refs.history && this.$refs.history.$emit(\'load-data\');\r\n                }\r\n              });\r\n            },\r\n            error(response) {\r\n              self.$message({\r\n                message: response.message,\r\n                type: \'warning\'\r\n              });\r\n            }\r\n          });\r\n        })\r\n        .catch(() => {});\r\n    },\r\n\r\n    editDialogClosed() {\r\n      this.editUserDialogVisible = false;\r\n      this.preEmail = \'\';\r\n      this.$refs.dataTable.$emit(\'load-data\');\r\n    }\r\n  }\r\n};\r\n<\/script>\r\n\r\n']}])}}]);
//# sourceMappingURL=22.42f1b5de891cf72570c6.js.map